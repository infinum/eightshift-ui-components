// AUTO-GENERATED FILE. DO NOT EDIT.
// Run the build-worker script to update.
export default "(function(){\"use strict\";var w=(t=>(t[t.ALPHA=0]=\"ALPHA\",t[t.BLUE=1]=\"BLUE\",t[t.GREEN=2]=\"GREEN\",t[t.RED=3]=\"RED\",t))(w||{});const $e=[\"rotateCW\",\"rotate180\",\"rotateCCW\"],Ln=(t,e=t,n,r={})=>{const s=document.createElement(\"canvas\");return Wn(s,t,e,r.dpr),r.pixelated&&(s.style.imageRendering=\"pixelated\"),{canvas:s,ctx:s.getContext(\"2d\",r.ctx)}},Hn=(t,e=t,n,r)=>Ln(t,e,n,{dpr:1,...r}),Wn=(t,e,n,r=window.devicePixelRatio||1)=>(r!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*r,t.height=n*r,r),P=t=>typeof t==\"number\";function Yn(t,e,n,r){let s,i;if(P(t)){const c=Hn(t,e,n,r);s=c.canvas,i=c.ctx}else s=t,i=s.getContext(\"2d\");const a=i.getImageData(0,0,s.width,s.height),o=new Uint32Array(a.data.buffer);return{canvas:s,ctx:i,img:a,data:o}}const st=(t,e,n)=>{n.configurable=!1},ot=(t,e={})=>{const n=Reflect.ownKeys(t),r=Reflect.ownKeys(e),s=Symbol(\"isa\");function i(a){for(let o of n){const c=Object.getOwnPropertyDescriptor(a.prototype,o);(!c||c.configurable)&&Object.defineProperty(a.prototype,o,{value:t[o],writable:!0})}return Object.defineProperty(a.prototype,s,{value:!0}),a}for(let a of r)Object.defineProperty(i,a,{value:e[a],enumerable:e.propertyIsEnumerable(a)});return Object.defineProperty(i,Symbol.hasInstance,{value:a=>!!a[s]}),i};ot({order(){return[0]},includes(t){return t>=0&&t<this.size[0]},indexAt(t){return this.includes(t)?this.indexAtUnsafe(t):-1},indexAtUnsafe(t){return this.offset+(t|0)*this.stride[0]},getAt(t){return this.includes(t)?this.data[this.indexAtUnsafe(t)]:0},getAtUnsafe(t){return this.data[this.indexAtUnsafe(t)]},setAt(t,e){return this.includes(t)?(this.data[this.indexAtUnsafe(t)]=e,!0):!1},setAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t)]=e,!0}});const Se=ot({order(){return Math.abs(this.stride[1])>Math.abs(this.stride[0])?[1,0]:[0,1]},includes(t,e){const n=this.size;return t>=0&&t<n[0]&&e>=0&&e<n[1]},indexAt(t,e){return this.includes(t,e)?this.indexAtUnsafe(t,e):-1},indexAtUnsafe(t,e){return this.offset+(t|0)*this.stride[0]+(e|0)*this.stride[1]},getAt(t,e){return this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)]:0},getAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t,e)]},setAt(t,e,n){return this.includes(t,e)?(this.data[this.indexAtUnsafe(t,e)]=n,!0):!1},setAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e)]=n,!0}});ot({order(){return ve(this.stride)},includes(t,e,n){const r=this.size;return t>=0&&t<r[0]&&e>=0&&e<r[1]&&n>=0&&n<r[2]},indexAt(t,e,n){return this.includes(t,e,n)?this.indexAtUnsafe(t,e,n):-1},indexAtUnsafe(t,e,n){const r=this.stride;return this.offset+(t|0)*r[0]+(e|0)*r[1]+(n|0)*r[2]},getAt(t,e,n){return this.includes(t,e,n)?this.data[this.indexAtUnsafe(t,e,n)]:0},getAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e,n)]},setAt(t,e,n,r){return this.includes(t,e,n)?(this.data[this.indexAtUnsafe(t,e,n)]=r,!0):!1},setAtUnsafe(t,e,n,r){return this.data[this.indexAtUnsafe(t,e,n)]=r,!0}}),ot({order(){return ve(this.stride)},includes(t,e,n,r){const s=this.size;return t>=0&&t<s[0]&&e>=0&&e<s[1]&&n>=0&&n<s[2]&&r>=0&&r<s[3]},indexAt(t,e,n,r){return this.includes(t,e,n,r)?this.indexAtUnsafe(t,e,n,r):-1},indexAtUnsafe(t,e,n,r){const s=this.stride;return this.offset+(t|0)*s[0]+(e|0)*s[1]+(n|0)*s[2]+(r|0)*s[3]},getAt(t,e,n,r){return this.includes(t,e,n,r)?this.data[this.indexAtUnsafe(t,e,n,r)]:0},getAtUnsafe(t,e,n,r){return this.data[this.indexAtUnsafe(t,e,n,r)]},setAt(t,e,n,r,s){return this.includes(t,e,n,r)?(this.data[this.indexAtUnsafe(t,e,n,r)]=s,!0):!1},setAtUnsafe(t,e,n,r,s){return this.data[this.indexAtUnsafe(t,e,n,r)]=s,!0}});const ve=t=>[...t].map((e,n)=>[e,n]).sort((e,n)=>Math.abs(n[0])-Math.abs(e[0])).map(e=>e[1]),j=t=>typeof t==\"string\",it=(t,e=n=>n!==void 0?\": \"+n:\"\")=>class extends Error{origMessage;constructor(n){super(t(n)+e(n)),this.origMessage=n!==void 0?String(n):\"\"}},Vn={};var Be={};const Xn=it(()=>\"Assertion failed\"),_=(typeof process<\"u\"&&Be!==void 0?Be.UMBRELLA_ASSERTS:!Vn)?(t,e)=>{if(typeof t==\"function\"&&!t()||!t)throw new Xn(typeof e==\"function\"?e():e)}:()=>{},B=(t,e,n)=>t<e?e:t>n?n:t,y=t=>t<0?0:t>1?1:t,Me=(t,e,n,r,s)=>(t[0]=e,t[1]=n,t[2]=r,t[3]=s,t),Kn=(t,e)=>{const n=e[3];return Me(e,e[0]*n,e[1]*n,e[2]*n,n)},Zn=t=>{const e=(t>>>24)/255;return t&4278190080|(t>>>16&255)*e<<16|(t>>>8&255)*e<<8|(t&255)*e},Jn=(t,e)=>{const n=e[3];return n>0?Me(e,e[0]/n,e[1]/n,e[2]/n,n):e},Qn=t=>{const e=(t>>>24)/255;return e>0?(t&4278190080|Math.min(255,(t>>>16&255)/e)<<16|Math.min(255,(t>>>8&255)/e)<<8|Math.min(255,(t&255)/e))>>>0:t},tr=t=>{const e=t[3];return t[0]<=e&&t[1]<=e||t[2]<=e},er=t=>{const e=t>>>24;return(t>>>16&255)<=e&&(t>>>8&255)<=e&&(t&255)<=e},ke=(t,e,n,r=1)=>_(t.length>=e*n*r,\"pixel buffer too small\"),Ge=(t,e,n)=>t?(It(t,e,n),t):new ImageData(e,n),It=(t,e,n)=>_(t.width===e&&t.height===n,\"imagedata has wrong dimensions\"),O=(t,e)=>{const n=t.channels[e];return _(n!=null,`invalid channel ID: ${e}`),n},nr=t=>_(!!t.alpha,\"missing alpha channel\"),at=t=>t,Ut=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/255,ct=(t,e,n,r,s,i,a=0,o=0)=>(t|=0,e|=0,n|=0,r|=0,t<0&&(n+=t,a-=t,t=0),e<0&&(r+=e,o-=e,e=0),[t,e,B(n,0,s-t),B(r,0,i-e),a,o]),lt=(t,e,n={})=>{const r=t.width,s=e.width;let i,a,o,c,l,h;return[i,a,l,h]=ct(n.sx||0,n.sy||0,n.w||r,n.h||t.height,r,t.height),[o,c,l,h,i,a]=ct(n.dx||0,n.dy||0,l,h,s,e.height,i,a),{sx:i,sy:a,dx:o,dy:c,rw:l,rh:h}},rr=(t,e,n)=>{for(let r=t.length;r-- >0;)t[r]=n(t[r],e)},sr=(t,e,n,r)=>{for(let s=t.length;s-- >0;)t[s]=r(t[s],n(e[s]))},or=(t,e,n,r,s)=>{const i=~s;for(let a=t.length;a-- >0;)t[a]=t[a]&i|n(r(e[a]))&s},Ie=(t,e,n)=>{const r=e.fromABGR,s=e.toABGR;for(let i=t.length;i-- >0;)t[i]=r(n(s(t[i])))},Ue=(t,e,n={})=>(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext(\"2d\"):e).putImageData(t.toImageData(n.data),n.x||0,n.y||0),ht=t=>{const e=t.channels,n=e.reduce((a,o)=>(a[o]=3-o<<3,a),{}),r={...t,__float:!0,size:e.length,shift:n,range:[0,1],normalized:y,fromNormalized:at};if(t.convert)return Object.assign(r,t.convert),r;const s=(a,o)=>(y(a[o])*255+.5|0)<<n[e[o]],i=(a,o)=>(a>>>n[e[o]]&255)/255;switch(e.length){case 1:t.gray?ar(r):ir(r,i,s);break;case 2:t.gray?lr(r,i):cr(r,i,s);break;case 3:hr(r,i,s);break;case 4:fr(r,i,s);break}return r},ir=(t,e,n)=>{t.toABGR=r=>{let s=t.alpha?0:4278190080;return s|=n(r,0),s>>>0},t.fromABGR=(r,s=[])=>(s[0]=e(r,0),s)},ar=t=>{t.toABGR=e=>((y(e[0])*255+.5|0)*65793|4278190080)>>>0,t.fromABGR=(e,n=[])=>(n[0]=Ut(e)/255,n)},cr=(t,e,n)=>{t.toABGR=r=>{let s=t.alpha?0:4278190080;return s|=n(r,0),s|=n(r,1),s>>>0},t.fromABGR=(r,s=[])=>(s[0]=e(r,0),s[1]=e(r,1),s)},lr=(t,e)=>{const n=~~(t.channels[0]===w.ALPHA),r=n^1;t.toABGR=s=>{let i=(y(s[n])*255+.5|0)*65793;return i|=(s[r]*255+.5|0)<<24,i>>>0},t.fromABGR=(s,i=[])=>(i[n]=Ut(s)/255,i[r]=e(s,r),i)},hr=(t,e,n)=>{t.toABGR=r=>{let s=t.alpha?0:4278190080;return s|=n(r,0),s|=n(r,1),s|=n(r,2),s>>>0},t.fromABGR=(r,s=[])=>(s[0]=e(r,0),s[1]=e(r,1),s[2]=e(r,2),s)},fr=(t,e,n)=>{t.toABGR=r=>{let s=t.alpha?0:4278190080;return s|=n(r,0),s|=n(r,1),s|=n(r,2),s|=n(r,3),s>>>0},t.fromABGR=(r,s=[])=>(s[0]=e(r,0),s[1]=e(r,1),s[2]=e(r,2),s[3]=e(r,3),s)},xe=ht({gray:!0,channels:[w.RED]}),ur={5120:\"i8\",5121:\"u8\",5122:\"i16\",5123:\"u16\",5124:\"i32\",5125:\"u32\",5126:\"f32\"},dr={f32:Float32Array,f64:Float64Array},gr={i8:Int8Array,i16:Int16Array,i32:Int32Array},mr={u8:Uint8Array,u8c:Uint8ClampedArray,u16:Uint16Array,u32:Uint32Array},yr={i64:BigInt64Array,u64:BigUint64Array},br={...dr,...gr,...mr},Ar=t=>{const e=ur[t];return e!==void 0?e:t};function ft(t,...e){const n=yr[t];return new(n||br[Ar(t)])(...e)}const _r=t=>t>16?\"u32\":t>8?\"u16\":\"u8\",xt=(t,e)=>e>0?`(${t} << ${e})`:e<0?`(${t} >>> ${-e})`:`${t}`,zt=(t,e)=>xt(t,-e),ze=t=>`0x${t.toString(16)}`,pr=t=>{const e=8-t,n=(1<<t)-1;return new Function(\"luma\",`return (x) => ${zt(\"luma(x)\",e)} & ${n};`)(Ut)},wr=t=>{let e;if(t!==8){const n=(1<<t)-1,r=255/n;e=`(((x & ${n}) * ${r}) | 0)`}else e=\"x\";return new Function(\"x\",`return 0xff000000 | (${e} * 0x010101);`)},Rr=t=>new Function(\"x\",\"return (\"+t.map(e=>{const n=e.abgrShift+(8-e.size);return`(${zt(\"x\",n)} & ${ze(e.maskA)})`}).join(\" | \")+\") >>> 0;\"),Cr=(t,e)=>{const n=t.map(s=>{if(s.size!==8){const i=s.mask0,a=255/i,o=zt(\"x\",s.shift);return xt(`((${o} & ${i}) * ${a})`,24-s.lane*8)}else return xt(`(x & ${ze(s.maskA)})`,s.abgrShift)}).join(\" | \"),r=e?\"\":\"0xff000000 | \";return new Function(\"x\",`return (${r}${n}) >>> 0;`)},$r=(t,e,n)=>{const r=1<<t.size,s=r-1,i=s<<n>>>0,a=~i>>>0,o=t.lane!=null?t.lane:e,c=h=>h>>>n&s,l=(h,u)=>h&a|(u&s)<<n;return{size:t.size,num:r,abgrShift:24-o*8-n,lane:o,shift:n,mask0:s,maskA:i,int:c,setInt:l,float:h=>c(h)/s,setFloat:(h,u)=>l(h,y(u)*s)}},Oe=t=>{_(t.channels.length>0,\"no channel specs given\");const e=t.channels.reduce(([n,r],s,i)=>(r-=s.size,n.push($r(s,i,r)),[n,r]),[[],t.size])[0];return{__packed:!0,type:t.type,size:t.size,alpha:t.alpha||0,channels:e,fromABGR:t.fromABGR||Rr(e),toABGR:t.toABGR||Cr(e,!!t.alpha)}},Ot=Oe({type:\"u32\",size:32,alpha:8,channels:[{size:8,lane:w.ALPHA},{size:8,lane:w.BLUE},{size:8,lane:w.GREEN},{size:8,lane:w.RED}],fromABGR:at,toABGR:at}),Ee=Math.PI,M=Ee*2,Sr=1/M;let I=1e-6;const Fe=(t,e,n,r,s,i)=>{const a=1-s,o=1-i;return t*a*o+e*s*o+n*a*i+r*s*i},K=(t,e,n,r,s)=>{r*=.5;const i=-.5*t+1.5*e-1.5*n+r,a=t-2.5*e+2*n-r,o=-.5*t+.5*n,c=e,l=s*s;return s*l*i+l*a+s*o+c},Te=(t,e,n,r,s,i,a,o,c,l,h,u,f,d,g,m,b,A)=>K(K(t,e,n,r,b),K(s,i,a,o,b),K(c,l,h,u,b),K(f,d,g,m,b),A),ut=(t,e)=>t-e*Math.floor(t/e),p=t=>t-Math.floor(t),De=(t,e=1)=>Math.round(t/e)*e;function Ne(t,e=\"linear\",n=\"clamp\"){const r=!!t.format.__float,s=t.format.channels.length===1?\"1\":\"\",i=`${e[0]}${n[0]}${s}`,a=(r?{nc1:dt,nw1:gt,nr1:mt,nc:dt,nw:gt,nr:mt,lc1:o=>Et(F(o)),lw1:o=>Et(T(o)),lr1:o=>Et(D(o)),lc:o=>Tt(o,dt(o)),lw:o=>Tt(o,gt(o)),lr:o=>Tt(o,mt(o)),cc1:o=>Nt(F(o)),cw1:o=>Nt(T(o)),cr1:o=>Nt(D(o)),cc:o=>Pt(o,dt(o)),cw:o=>Pt(o,gt(o)),cr:o=>Pt(o,mt(o))}:{nc1:F,nw1:T,nr1:D,nc:F,nw:T,nr:D,lc1:o=>yt(F(o)),lw1:o=>yt(T(o)),lr1:o=>yt(D(o)),lc:o=>Ft(o,F(o)),lw:o=>Ft(o,T(o)),lr:o=>Ft(o,D(o)),cc1:o=>Dt(o,F(o)),cw1:o=>Dt(o,T(o)),cr1:o=>Dt(o,D(o)),cc:o=>qt(o,F(o)),cw:o=>qt(o,T(o)),cr:o=>qt(o,D(o))})[i];return _(!!a,`missing impl for ${i}`),a(t)}const F=({data:t,width:e,height:n})=>(r,s)=>r>=0&&r<e&&s>=0&&s<n?t[(s|0)*e+(r|0)]:0,T=({data:t,width:e,height:n})=>(r,s)=>t[ut(s|0,n)*e+ut(r|0,e)],D=({data:t,width:e,height:n})=>{const r=e-1,s=n-1;return(i,a)=>t[B(a|0,0,s)*e+B(i|0,0,r)]},dt=({data:t,width:e,height:n,stride:[r,s]})=>(i,a)=>{let o;return i>=0&&i<e&&a>=0&&a<n?(o=(a|0)*s+(i|0)*r,t.slice(o,o+r)):[0]},gt=({data:t,width:e,height:n,stride:[r,s]})=>(i,a)=>{let o=ut(a|0,n)*s+ut(i|0,e)*r;return t.slice(o,o+r)},mt=({data:t,width:e,height:n,stride:[r,s]})=>{const i=e-1,a=n-1;return(o,c)=>{let l=B(c|0,0,a)*s+B(o|0,0,i)*r;return t.slice(l,l+r)}},Z=(t,e,n,r,s=4)=>Fe(t[r],t[r+s],t[r+2*s],t[r+3*s],e,n),yt=t=>(e,n)=>(e-=.5,n-=.5,Fe(t(e,n),t(e+1,n),t(e,n+1),t(e+1,n+1),p(e),p(n))),Et=t=>(t=yt(t),(e,n)=>[t(e,n)]),Ft=(t,e)=>{const{fromABGR:n,toABGR:r}=t.format,s=new Uint32Array(4),i=new Uint8Array(s.buffer);return(a,o)=>{a-=.5,o-=.5,s[0]=r(e(a,o)),s[1]=r(e(a+1,o)),s[2]=r(e(a,o+1)),s[3]=r(e(a+1,o+1));const c=p(a),l=p(o);return n(Z(i,c,l,0)|Z(i,c,l,1)<<8|Z(i,c,l,2)<<16|Z(i,c,l,3)<<24)>>>0}},Tt=({stride:[t]},e)=>{const n=new Float32Array(t*4);return(r,s)=>{r-=.5,s-=.5,n.set(e(r,s),0),n.set(e(r+1,s),t),n.set(e(r,s+1),t*2),n.set(e(r+1,s+1),t*3);const i=p(r),a=p(s);let o=[];for(let c=0;c<t;c++)o.push(Z(n,i,a,c,t));return o}},qe=t=>(e,n)=>{e-=.5,n-=.5;const r=e-1,s=e+1,i=e+2,a=n-1,o=n+1,c=n+2;return Te(t(r,a),t(e,a),t(s,a),t(i,a),t(r,n),t(e,n),t(s,n),t(i,n),t(r,o),t(e,o),t(s,o),t(i,o),t(r,c),t(e,c),t(s,c),t(i,c),p(e),p(n))},Dt=(t,e)=>{const n=t.format.channels[0].mask0;return e=qe(e),(r,s)=>B(e(r,s),0,n)},Nt=t=>(t=qe(t),(e,n)=>[t(e,n)]),Pe=(t,e,n,r,s=4)=>Te(t[r],t[r+s],t[r+2*s],t[r+3*s],t[r+4*s],t[r+5*s],t[r+6*s],t[r+7*s],t[r+8*s],t[r+9*s],t[r+10*s],t[r+11*s],t[r+12*s],t[r+13*s],t[r+14*s],t[r+15*s],e,n),bt=(t,e,n,r,s=4)=>B(Pe(t,e,n,r,s),0,255),qt=(t,e)=>{const{fromABGR:n,toABGR:r}=t.format,s=new Uint32Array(16),i=new Uint8Array(s.buffer);return(a,o)=>{a-=.5,o-=.5;const c=a-1,l=a+1,h=a+2,u=o-1,f=o+1,d=o+2,g=p(a),m=p(o);return s[0]=r(e(c,u)),s[1]=r(e(a,u)),s[2]=r(e(l,u)),s[3]=r(e(h,u)),s[4]=r(e(c,o)),s[5]=r(e(a,o)),s[6]=r(e(l,o)),s[7]=r(e(h,o)),s[8]=r(e(c,f)),s[9]=r(e(a,f)),s[10]=r(e(l,f)),s[11]=r(e(h,f)),s[12]=r(e(c,d)),s[13]=r(e(a,d)),s[14]=r(e(l,d)),s[15]=r(e(h,d)),n(bt(i,g,m,0)|bt(i,g,m,1)<<8|bt(i,g,m,2)<<16|bt(i,g,m,3)<<24)>>>0}},Pt=({stride:[t]},e)=>{const n=new Float32Array(t*16);return(r,s)=>{r-=.5,s-=.5;const i=r-1,a=r+1,o=r+2,c=s-1,l=s+1,h=s+2,u=p(r),f=p(s);n.set(e(i,c),0),n.set(e(r,c),t),n.set(e(a,c),2*t),n.set(e(o,c),3*t),n.set(e(i,s),4*t),n.set(e(r,s),5*t),n.set(e(a,s),6*t),n.set(e(o,s),7*t),n.set(e(i,l),8*t),n.set(e(r,l),9*t),n.set(e(a,l),10*t),n.set(e(o,l),11*t),n.set(e(i,h),12*t),n.set(e(r,h),13*t),n.set(e(a,h),14*t),n.set(e(o,h),15*t);let d=[];for(let g=0;g<t;g++)d.push(Pe(n,u,f,g,t));return d}};var vr=Object.getOwnPropertyDescriptor,Br=(t,e,n,r)=>{for(var s=r>1?void 0:r?vr(e,n):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(s=a(s)||s);return s};function Mr(...t){return t[0]instanceof U?t[0].as(t[1]):new U(...t)}const kr=(t,e=Ot)=>{const{data:n}=Yn(t),r=t.width,s=t.height;let i;if(e===Ot)i=n;else{i=ft(e.type,r*s);const a=n,o=e.fromABGR;for(let c=i.length;c-- >0;)i[c]=o(a[c])}return new U(r,s,e,i)};let U=class{size;stride;format;data;constructor(t,e,n=Ot,r){this.size=[t,e],this.stride=[1,t],this.format=n.__packed?n:Oe(n),this.data=r||ft(n.type,t*e)}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}*[Symbol.iterator](){yield*this.data}as(t){if(!t.__float)return this.getRegion(0,0,this.width,this.height,t);const e=new S(this.width,this.height,t),{data:n,format:r,stride:[s]}=e,{data:i,format:a}=this;for(let o=i.length;o-- >0;)n.set(r.fromABGR(a.toABGR(i[o])),o*s);return e}copy(){const t=this.empty();return t.data.set(this.data),t}empty(){return new U(this.width,this.height,this.format)}order(){}includes(t,e){}indexAt(t,e){}indexAtUnsafe(t,e){}getAt(t,e){}getAtUnsafe(t,e){}setAt(t,e,n){}setAtUnsafe(t,e,n){}getChannelAt(t,e,n,r=!1){const s=O(this.format,n),i=this.getAt(t,e);return r?s.float(i):s.int(i)}setChannelAt(t,e,n,r,s=!1){const i=O(this.format,n),a=this.getAt(t,e);return s?i.setFloat(a,r):i.setInt(a,r),this}blend(t,e,n){let r=this.width,s=e.width;const{sx:i,sy:a,dx:o,dy:c,rw:l,rh:h}=lt(this,e,n);if(l<1||h<1)return e;const u=this.data,f=e.data,d=this.format.toABGR,g=e.format.toABGR,m=e.format.fromABGR;for(let b=(i|0)+(a|0)*r,A=(o|0)+(c|0)*s,E=0;E<h;E++,b+=r,A+=s)for(let z=0;z<l;z++)f[A+z]=m(t(d(u[b+z]),g(f[A+z])));return e}blit(t,e){let n=this.width,r=t.width;const{sx:s,sy:i,dx:a,dy:o,rw:c,rh:l}=lt(this,t,e);if(c<1||l<1)return t;const h=this.data,u=t.data,f=this.format.toABGR,d=t.format.fromABGR,g=this.format!==t.format?(m,b)=>{for(let A=0;A<c;A++)u[b+A]=d(f(h[m+A]))}:(m,b)=>u.set(h.subarray(m,m+c),b);for(let m=(s|0)+(i|0)*n,b=(a|0)+(o|0)*r,A=0;A<l;A++,m+=n,b+=r)g(m,b);return t}blitCanvas(t,e={}){Ue(this,t,e)}setImageData(t){It(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,r=this.format.fromABGR;for(let s=e.length;s-- >0;)n[s]=r(e[s]);return this}toImageData(t){t=Ge(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,r=this.format.toABGR;for(let s=e.length;s-- >0;)e[s]=r(n[s]);return t}getRegion(t,e,n,r,s){const[i,a,o,c]=ct(t,e,n,r,this.width,this.height);if(!(o<1||c<1))return this.blit(new U(o,c,s||this.format),{sx:i,sy:a,w:o,h:c})}getChannel(t){const e=O(this.format,t),n=new U(this.width,this.height,{type:_r(e.size),size:e.size,channels:[{size:e.size,lane:w.RED}],fromABGR:pr(e.size),toABGR:wr(e.size)}),r=this.data,s=n.data,i=e.int;for(let a=r.length;a-- >0;)s[a]=i(r[a]);return n}setChannel(t,e){const n=O(this.format,t),r=this.data,s=n.setInt;if(P(e))rr(r,e,s);else{const i=e.data,a=e.format.channels[0];ke(i,this.width,this.height),n.size===a.size?sr(r,i,a.int,s):or(r,i,this.format.fromABGR,e.format.toABGR,n.maskA)}return this}invert(){const{data:t,format:e}=this,n=Math.pow(2,e.size-e.alpha)-1;for(let r=t.length;r-- >0;)t[r]^=n;return this}premultiply(){return nr(this.format),Ie(this.data,this.format,Zn),this}postmultiply(){return Ie(this.data,this.format,Qn),this}isPremultiplied(){const t=this.data,e=this.format.toABGR;for(let n=t.length;n-- >0;)if(!er(e(t[n])))return!1;return!0}forEach(t){const e=this.data;for(let n=e.length;n-- >0;)e[n]=t(e[n],n);return this}fill(t){this.data.fill(t)}flipX(){const{data:t,width:e}=this;for(let n=0;n<t.length;n+=e)t.subarray(n,n+e).reverse();return this}flipY(){const{data:t,width:e}=this,n=ft(this.format.type,e);for(let r=0,s=t.length-e;r<s;r+=e,s-=e)n.set(t.subarray(r,r+e)),t.copyWithin(r,s,s+e),t.set(n,s);return this}rotateByID(t){return t>0?this[$e[t-1]]():this}rotateCW(){const{width:t,height:e}=this,n=e-1;return this._rotate((r,s)=>r*e+n-s),this.size[0]=e,this.size[1]=t,this}rotateCCW(){const{width:t,height:e}=this,n=t-1;return this._rotate((r,s)=>(n-r)*e+s),this.size[0]=e,this.size[1]=t,this}rotate180(){const{width:t,height:e}=this,n=t-1,r=e-1;return this._rotate((s,i)=>(r-i)*t+n-s),this}scale(t,e=\"linear\"){return _(t>0,\"scale must be > 0\"),this.resize(this.width*t,this.height*t,e)}resize(t,e,n=\"linear\"){t|=0,e|=0,_(t>0&&e>0,\"target width & height must be > 0\");const r=Mr(t,e,this.format),s=r.data,i=t>0?this.width/t:0,a=e>0?this.height/e:0;n=j(n)?Ne(this,n,\"repeat\"):n;for(let o=0,c=0;o<e;o++){const l=o*a;for(let h=0;h<t;h++,c++)s[c]=n(h*i,l)}return r}upsize(){const{width:t,height:e,data:n}=this,r=new U(t*2,e*2,this.format),s=r.data;for(let i=0,a=0;i<e;i++)for(let o=0,c=i*t*4;o<t;o++,a++,c+=2)s[c]=n[a];return r}_rotate(t){const{data:e,format:n,width:r,height:s}=this,i=ft(n.type,r*s);for(let a=0;a<s;a++)for(let o=0;o<r;o++)i[t(o,a)]=e[a*r+o];this.data=i}};U=Br([Se],U);var Gr=Object.defineProperty,Ir=Object.getOwnPropertyDescriptor,J=(t,e,n,r)=>{for(var s=r>1?void 0:r?Ir(e,n):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(s=(r?a(e,n,s):a(s))||s);return r&&s&&Gr(e,n,s),s};function je(...t){return t[0]instanceof U?Ur(...t):new S(...t)}const Ur=(t,e)=>{const n=new S(t.width,t.height,e),{data:r,format:s,stride:[i]}=n,{data:a,format:o}=t;for(let c=a.length;c-- >0;)r.set(s.fromABGR(o.toABGR(a[c])),c*i);return n},xr=(t,e=L)=>kr(t).as(e);let S=class{size;stride;format;data;__empty;constructor(t,e,n=L,r){this.size=[t,e],this.format=n.__float?n:ht(n);const s=this.format.channels.length;this.stride=[s,t*s],this.data=r||new Float32Array(t*e*s),this.__empty=Object.freeze(new Array(s).fill(0))}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}*[Symbol.iterator](){const{data:t,stride:[e]}=this;for(let n=0,r=t.length;n<r;n+=e)yield t.subarray(n,n+e)}as(t){const{width:e,height:n,stride:[r],data:s,format:{size:i,normalized:a,toABGR:o}}=this;let c=0,l=0,h=s.length;if(t.__float){const u=t,f=new S(e,n,u),{data:d,stride:[g]}=f;if(i===1&&u.channels.length===1){const m=u.fromNormalized;for(;c<h;c+=r,l+=g)d[l]=m(a(s[c]))}else for(;c<h;c+=r,l+=g)d.set(u.fromABGR(o(s.subarray(c,c+r))),l);return f}else{const u=t,f=new U(e,n,u),d=f.data;if(i===1&&u.channels.length===1){const g=u.channels[0].setFloat;for(;c<h;c+=r,l++)d[l]=g(0,a(s[c]))}else for(;c<h;c+=r,l++)d[l]=u.fromABGR(o(s.subarray(c,c+r)));return f}}copy(){const t=this.empty();return t.data.set(this.data),t}empty(){return new S(this.width,this.height,this.format)}order(){}includes(t,e){}indexAt(t,e){}indexAtUnsafe(t,e){}getAt(t,e){return this.includes(t,e)?this.getAtUnsafe(t,e):this.__empty}getAtUnsafe(t,e){const n=this.indexAtUnsafe(t,e);return this.data.subarray(n,n+this.stride[0])}setAt(t,e,n){return this.includes(t,e)?(this.data.set(n,this.indexAtUnsafe(t,e)),!0):!1}setAtUnsafe(t,e,n){return this.data.set(n,this.indexAtUnsafe(t,e)),!0}getChannelAt(t,e,n){return O(this.format,n),this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)+n]:void 0}setChannelAt(t,e,n,r){return O(this.format,n),this.includes(t,e)&&(this.data[this.indexAtUnsafe(t,e)+n]=r),this}getChannel(t){O(this.format,t);const{data:e,stride:[n]}=this,[r,s]=this.format.range,i=new Float32Array(this.width*this.height);for(let a=t,o=0,c=e.length;a<c;a+=n,o++)i[o]=B(e[a],r,s);return new S(this.width,this.height,xe,i)}setChannel(t,e){O(this.format,t);const{data:n,stride:[r]}=this;if(P(e))for(let s=t,i=n.length;s<i;s+=r)n[s]=e;else{const{data:s,stride:[i]}=e;ke(s,this.width,this.height,i);for(let a=t,o=0,c=n.length;a<c;a+=r,o+=i)n[a]=s[o]}return this}blend(t,e,n){this.ensureFormat(e);const{sx:r,sy:s,dx:i,dy:a,rw:o,rh:c}=lt(this,e,n);if(o<1||c<1)return e;const l=this.data,h=e.data,[u,f]=this.stride,d=e.stride[1];for(let g=(r|0)*u+(s|0)*f,m=(i|0)*u+(a|0)*d,b=0;b<c;b++,g+=f,m+=d)for(let A=o,E=g,z=m;A-- >0;E+=u,z+=u){const Gt=h.subarray(z,z+u);t(Gt,l.subarray(E,E+u),Gt)}return e}blit(t,e){this.ensureFormat(t);const{sx:n,sy:r,dx:s,dy:i,rw:a,rh:o}=lt(this,t,e);if(a<1||o<1)return t;const c=this.data,l=t.data,[h,u]=this.stride,f=t.stride[1],d=a*h;for(let g=(n|0)*h+(r|0)*u,m=(s|0)*h+(i|0)*f,b=0;b<o;b++,g+=u,m+=f)l.set(c.subarray(g,g+d),m);return t}blitCanvas(t,e={}){Ue(this,t,e)}setImageData(t){It(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),{data:n,format:{fromABGR:r},stride:[s]}=this,i=[];for(let a=e.length;a-- >0;)n.set(r(e[a],i),a*s);return this}toImageData(t){t=Ge(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),{stride:[n],data:r,format:s}=this;for(let i=0,a=0,o=r.length;i<o;i+=n,a++)e[a]=s.toABGR(r.subarray(i,i+n));return t}getRegion(t,e,n,r){const[s,i,a,o]=ct(t,e,n,r,this.width,this.height);if(!(a<1||o<1))return this.blit(new S(a,o,this.format),{sx:s,sy:i,w:a,h:o})}forEach(t){const{data:e,stride:[n]}=this;for(let r=0,s=0,i=e.length;r<i;r+=n,s++)e.set(t(e.subarray(r,r+n),s),r);return this}fill(t){_(t.length<=this.format.channels.length,\"fill value has too many channels\");const{data:e,stride:[n]}=this;for(let r=0,s=e.length;r<s;r+=n)e.set(t,r)}premultiply(){this.ensureRGBA();const{data:t,stride:[e]}=this;for(let n=0,r=t.length;n<r;n+=e)Kn(null,t.subarray(n,n+e));return this}postmultiply(){this.ensureRGBA();const{data:t,stride:[e]}=this;for(let n=0,r=t.length;n<r;n+=e)Jn(null,t.subarray(n,n+e));return this}isPremultiplied(){this.ensureRGBA();const{data:t,stride:[e]}=this;for(let n=0,r=t.length;n<r;n+=e)if(!tr(t.subarray(n,n+e)))return!1;return!0}clamp(){const t=this.data,[e,n]=this.format.range;for(let r=t.length;r-- >0;)t[r]=B(t[r],e,n);return this}clampChannel(t){O(this.format,t);const{data:e,stride:[n]}=this,[r,s]=this.format.range;for(let i=t,a=e.length;i<a;i+=n)e[i]=B(e[i],r,s)}flipX(){const{data:t,width:e,height:n,stride:[r,s]}=this,i=new Float32Array(r),a=e-1,o=e>>>1;for(let c=0;c<n;c++)for(let l=0,h=c*s,u=h+a*r;l<o;l++,h+=r,u-=r)i.set(t.subarray(h,h+r)),t.copyWithin(h,u,u+r),t.set(i,u);return this}flipY(){const t=this.data,e=this.stride[1],n=new Float32Array(e);for(let r=0,s=t.length-e;r<s;r+=e,s-=e)n.set(t.subarray(r,r+e)),t.copyWithin(r,s,s+e),t.set(n,s);return this}rotateByID(t){return t>0?this[$e[t-1]]():this}rotateCW(){const{width:t,height:e}=this,n=e-1;return this._rotate((r,s)=>r*e+n-s),this.size[0]=e,this.size[1]=t,this}rotateCCW(){const{width:t,height:e}=this,n=t-1;return this._rotate((r,s)=>(n-r)*e+s),this.size[0]=e,this.size[1]=t,this}rotate180(){const{width:t,height:e}=this,n=t-1,r=e-1;return this._rotate((s,i)=>(r-i)*t+n-s),this}invert(){const{data:t,format:e,stride:[n]}=this;for(let r=0,s=t.length,i=e.alpha?n-1:n;r<s;r+=n)for(let a=0;a<i;a++)t[r+a]=1-t[r+a];return this}scale(t,e){return _(t>0,\"scale must be > 0\"),this.resize(this.width*t,this.height*t,e)}resize(t,e,n=\"linear\"){t|=0,e|=0,_(t>0&&e>0,\"target width & height must be > 0\");const r=je(t,e,this.format),s=r.data,i=t>0?this.width/t:0,a=e>0?this.height/e:0,o=this.stride[0];n=j(n)?Ne(this,n,\"repeat\"):n;for(let c=0,l=0;c<e;c++){const h=c*a;for(let u=0;u<t;u++,l+=o)s.set(n(u*i,h),l)}return r}upsize(){const{width:t,height:e,data:n,stride:[r,s]}=this,i=r*2,a=je(t*2,e*2,this.format),o=a.data;for(let c=0,l=0;c<e;c++)for(let h=0,u=c*s*4;h<t;h++,l+=r,u+=i)o.set(n.subarray(l,l+r),u);return a}_rotate(t){const{data:e,width:n,height:r,stride:[s]}=this,i=new Float32Array(n*r*s);for(let a=0,o=0;a<r;a++)for(let c=0;c<n;c++,o+=s)i.set(e.subarray(o,o+s),t(c,a)*s);this.data=i}ensureFormat(t){_(t.format===this.format,\"dest buffer format must be same as src\")}ensureRGBA(){_(this.format===L,\"require FLOAT_RGBA format\")}};J([st],S.prototype,\"getAt\",1),J([st],S.prototype,\"getAtUnsafe\",1),J([st],S.prototype,\"setAt\",1),J([st],S.prototype,\"setAtUnsafe\",1),S=J([Se],S);const zr=(t,e,n)=>(t-e)/(n-e),Or=(t,e,n,r,s)=>r+(s-r)*zr(t,e,n),At=Math.abs,Er=Math.min,Fr=ht({alpha:!0,channels:[w.RED,w.GREEN,w.BLUE,w.ALPHA],convert:{fromABGR:(t,e=[])=>{const n=(t>>>24&255)/255,r=(t>>>16&255)/255,s=(t>>>8&255)/255,i=(t&255)/255;let a,o,c,l,h,u,f,d;s<r?(a=r,o=s,c=-1,l=2/3):(a=s,o=r,c=0,l=-1/3),i<a?(h=a,u=o,f=l,d=i):(h=i,u=o,f=c,d=a);const g=h-Er(u,d);return h=y(h),e[0]=y(At((d-u)/(6*g+I)+f)),e[1]=y(g/(h+I)),e[2]=h,e[3]=n,e},toABGR:t=>{const e=t[0]*6,n=t[1],r=t[2]*255,s=t[3]*255,i=((y(At(e-3)-1)-1)*n+1)*r,a=((y(2-At(e-2))-1)*n+1)*r,o=((y(2-At(e-4))-1)*n+1)*r;return(s<<24|o<<16|a<<8|i)>>>0}}}),L=ht({alpha:!0,channels:[w.RED,w.GREEN,w.BLUE,w.ALPHA]}),Tr=it(()=>\"unsupported operation\"),jt=t=>{throw new Tr(t)},k=(t=1,e,...n)=>{const r=[,,].concat(n),s=(...i)=>{const a=r[i[t].length]||e;return a?a(...i):jt(`no impl for vec size ${i[t].length}`)};return s.add=(i,a)=>r[i]=a,s.default=i=>e=i,s.impl=i=>i!=null&&r[i]||e,s},Dr=(t,e)=>t[0]*e[0]+t[1]*e[1],Lt=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],Nr=k(0,(t,e)=>{let n=0;for(let r=t.length;r-- >0;)n+=t[r]*e[r];return n},Dr,Lt,(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]);function Le(t,e=Object.create(null)){return(...n)=>{const r=JSON.stringify(n);return r!==void 0?r in e?e[r]:e[r]=t.apply(null,n):t.apply(null,n)}}function He(t,e=Object.create(null)){return(...n)=>{const r=n.join(\"-\");return r in e?e[r]:e[r]=t(...n)}}const qr=He((t,e)=>t.repeat(e)),We=Le((t,e=!1)=>e?n=>Pr(n)||n.toFixed(t):n=>n.toFixed(t)),Pr=t=>isNaN(t)?\"NaN\":t===1/0?\"+∞\":t===-1/0?\"-∞\":void 0,jr=(t=0)=>e=>(e*100).toFixed(t)+\"%\",Lr=[.299,.587,.114],Ye=[.2126,.7152,.0722],Hr=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],Wr=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],Yr=[.96422,1,.82521],Vr=[.95047,1,1.08883],Xr=[.2104542553,1.9779984951,.0259040371,.793617785,-2.428592205,.7827717662,-.0040720468,.4505937099,-.808675766];let _t=We(3),Ve=jr(3);const G=1/255,Ht=(t,e=Ye)=>Lt(t,e),Kr=t=>Lt(t,Lr),Zr=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t),Jr=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t),H=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t),Qr=k(1,(t,e)=>{!t&&(t=[]);for(let n=e.length;n-- >0;)t[n]=e[n];return t},Zr,Jr,H),Q=(t,e)=>typeof t?.[e]==\"function\",Wt=t=>t!=null&&typeof t!=\"function\"&&t.length!==void 0,ts=it(()=>\"illegal argument(s)\"),Yt=t=>{throw new ts(t)},es=Le((t,e=3,n=\",\",r=\"[\",s=\"]\")=>{const i=typeof e==\"number\"?We(e):e;switch(t){case 1:return a=>`${r}${i(a[0])}${s}`;case 2:return a=>`${r}${i(a[0])}${n}${i(a[1])}${s}`;case 3:return a=>`${r}${i(a[0])}${n}${i(a[1])}${n}${i(a[2])}${s}`;case 4:return a=>`${r}${i(a[0])}${n}${i(a[1])}${n}${i(a[2])}${n}${i(a[3])}${s}`;default:return a=>{const o=[];for(let c=0;c<a.length;c++)o.push(i(a[c]));return`${r}${o.join(n)}${s}`}}}),ns=(t,e,n,r,s,i)=>{const a=[];for(;n-- >0;)a.push(new t(e,r,s)),r+=i;return a},rs=(t,e=1,n=!0)=>{const r=n?(o,c,l,h)=>{!o&&(o=c);for(let u=c.length;u-- >0;)o[u]=t(c[u],l[u],h[u]);return o}:(o,c,l,h)=>{!o&&(o=h);for(let u=c.length;u-- >0;)o[u]=t(c[u],l[u],h[u]);return o},s=n?(o,c,l,h)=>(!o&&(o=c),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o):(o,c,l,h)=>(!o&&(o=h),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o),i=n?(o,c,l,h)=>(!o&&(o=c),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o[2]=t(c[2],l[2],h[2]),o):(o,c,l,h)=>(!o&&(o=h),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o[2]=t(c[2],l[2],h[2]),o),a=n?(o,c,l,h)=>(!o&&(o=c),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o[2]=t(c[2],l[2],h[2]),o[3]=t(c[3],l[3],h[3]),o):(o,c,l,h)=>(!o&&(o=h),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o[2]=t(c[2],l[2],h[2]),o[3]=t(c[3],l[3],h[3]),o);return[k(e,r,s,i,a),s,i,a]},[ui,di,gi,ss]=rs(B),os=ss,is=(t,e,n,r=!0,s=!0)=>{const i=n>0?r?function(){return this.buf[this.offset+n*this.stride]}:function(){return this.buf[this.offset+n]}:function(){return this.buf[this.offset]},a=n>0?r?function(o){this.buf[this.offset+n*this.stride]=o}:function(o){this.buf[this.offset+n]=o}:function(o){this.buf[this.offset]=o};s&&Object.defineProperty(t,n,{get:i,set:a,enumerable:!0}),Object.defineProperty(t,e,{get:i,set:a,enumerable:!0})},as=(t,e,n,r)=>e.forEach((s,i)=>is(t,s,i,n,r)),cs=Math.abs,x=(t,e,n=I)=>cs(t-e)<=n,ls=(t,e,n=I)=>t.length===e.length&&x(t[0],e[0],n)&&x(t[1],e[1],n),hs=(t,e,n=I)=>t.length===e.length&&x(t[0],e[0],n)&&x(t[1],e[1],n)&&x(t[2],e[2],n),Xe=(t,e,n=I)=>t.length===e.length&&x(t[0],e[0],n)&&x(t[1],e[1],n)&&x(t[2],e[2],n)&&x(t[3],e[3],n);k(0,(t,e,n=I)=>Q(t,\"eqDelta\")?t.eqDelta(e,n):Q(e,\"eqDelta\")?e.eqDelta(t,n):fs(t,e,t.length,n),ls,hs,Xe);const fs=(t,e,n,r=I,s=0,i=0,a=1,o=1)=>{for(;n>0;n--,s+=a,i+=o)if(!x(t[s],e[i],r))return!1;return!0};function*us(t,e,n,r){for(;e-- >0;)yield t[n],n+=r}const Ke=1/2**32;class ds{float(e=1){return this.int()*Ke*e}probability(e){return this.float()<e}norm(e=1){return(this.int()*Ke-.5)*2*e}normMinMax(e,n){const r=this.minmax(e,n);return this.float()<.5?r:-r}minmax(e,n){return this.float()*(n-e)+e}minmaxInt(e,n){e|=0;const r=(n|0)-e;return r?e+this.int()%r:e}minmaxUint(e,n){e>>>=0;const r=(n>>>0)-e;return r?e+this.int()%r:e}}class gs extends ds{constructor(e){super(),this.rnd=e}float(e=1){return this.rnd()*e}norm(e=1){return(this.rnd()-.5)*2*e}int(){return this.rnd()*4294967296>>>0}}const Vt=new gs(Math.random),ms=(t,e,n=Vt)=>{const r=t.length;_(r>0,\"no choices given\");const s=e?t.map((a,o)=>[e[o]||0,a]).sort((a,o)=>o[0]-a[0]):t.map(a=>[1,a]),i=s.reduce((a,o)=>a+o[0],0);return i<=0&&console.warn(\"total weights <= 0\"),()=>{const a=n.float(i);let o=i;for(let c=0;c<r;c++)if(o-=s[c][0],o<=a)return s[c][1]}},ys=k(1,(t,e,n,r=Vt)=>{!t&&(t=e);for(let s=e.length;s-- >0;)t[s]=r.minmax(e[s],n[s]);return t}),Ze=Array.isArray,tt={},Je=(t,e)=>{for(let n in e){const r=e[n];if(Ze(r)){const[s,i,a,o]=r;e[n]=r.length===2?(c,l)=>i(c,s(c,l)):r.length===3?(c,l)=>a(c,i(c,s(c,l))):(c,l)=>o(c,a(c,i(c,s(c,l))))}}tt[t]={...tt[t],...e}},Qe=(t,e,n,r)=>{const s=tt[n];_(!!s,`no conversions available for ${n}`);let i=s[r];return i?i(t,e):tt.rgb[r]?s.rgb(t,tt.rgb[r]([],e)):jt(`can't convert: ${r} -> ${n}`)},tn=(t,e)=>(t>>>e|t<<32-e)>>>0,bs=t=>(t&3840)*4352|(t&240)*272|(t&15)*17,As=t=>((t&61440)*69632|(t&3840)*4352|(t&240)*272|(t&15)*17)>>>0;class N{constructor(e,n){this.mode=e,this.value=n}deref(){return this.value}}const _s={aliceblue:\"f0f8ff\",antiquewhite:\"faebd7\",aqua:\"0ff\",aquamarine:\"7fffd4\",azure:\"f0ffff\",beige:\"f5f5dc\",bisque:\"ffe4c4\",black:\"000\",blanchedalmond:\"ffebcd\",blue:\"00f\",blueviolet:\"8a2be2\",brown:\"a52a2a\",burlywood:\"deb887\",cadetblue:\"5f9ea0\",chartreuse:\"7fff00\",chocolate:\"d2691e\",coral:\"ff7f50\",cornflowerblue:\"6495ed\",cornsilk:\"fff8dc\",crimson:\"dc143c\",cyan:\"0ff\",darkblue:\"00008b\",darkcyan:\"008b8b\",darkgoldenrod:\"b8860b\",darkgray:\"a9a9a9\",darkgreen:\"006400\",darkgrey:\"a9a9a9\",darkkhaki:\"bdb76b\",darkmagenta:\"8b008b\",darkolivegreen:\"556b2f\",darkorange:\"ff8c00\",darkorchid:\"9932cc\",darkred:\"8b0000\",darksalmon:\"e9967a\",darkseagreen:\"8fbc8f\",darkslateblue:\"483d8b\",darkslategray:\"2f4f4f\",darkslategrey:\"2f4f4f\",darkturquoise:\"00ced1\",darkviolet:\"9400d3\",deeppink:\"ff1493\",deepskyblue:\"00bfff\",dimgray:\"696969\",dimgrey:\"696969\",dodgerblue:\"1e90ff\",firebrick:\"b22222\",floralwhite:\"fffaf0\",forestgreen:\"228b22\",fuchsia:\"f0f\",gainsboro:\"dcdcdc\",ghostwhite:\"f8f8ff\",gold:\"ffd700\",goldenrod:\"daa520\",gray:\"808080\",grey:\"808080\",green:\"008000\",greenyellow:\"adff2f\",honeydew:\"f0fff0\",hotpink:\"ff69b4\",indianred:\"cd5c5c\",indigo:\"4b0082\",ivory:\"fffff0\",khaki:\"f0e68c\",lavender:\"e6e6fa\",lavenderblush:\"fff0f5\",lawngreen:\"7cfc00\",lemonchiffon:\"fffacd\",lightblue:\"add8e6\",lightcoral:\"f08080\",lightcyan:\"e0ffff\",lightgoldenrodyellow:\"fafad2\",lightgray:\"d3d3d3\",lightgreen:\"90ee90\",lightgrey:\"d3d3d3\",lightpink:\"ffb6c1\",lightsalmon:\"ffa07a\",lightseagreen:\"20b2aa\",lightskyblue:\"87cefa\",lightslategray:\"789\",lightslategrey:\"789\",lightsteelblue:\"b0c4de\",lightyellow:\"ffffe0\",lime:\"0f0\",limegreen:\"32cd32\",linen:\"faf0e6\",magenta:\"f0f\",maroon:\"800000\",mediumaquamarine:\"66cdaa\",mediumblue:\"0000cd\",mediumorchid:\"ba55d3\",mediumpurple:\"9370db\",mediumseagreen:\"3cb371\",mediumslateblue:\"7b68ee\",mediumspringgreen:\"00fa9a\",mediumturquoise:\"48d1cc\",mediumvioletred:\"c71585\",midnightblue:\"191970\",mintcream:\"f5fffa\",mistyrose:\"ffe4e1\",moccasin:\"ffe4b5\",navajowhite:\"ffdead\",navy:\"000080\",oldlace:\"fdf5e6\",olive:\"808000\",olivedrab:\"6b8e23\",orange:\"ffa500\",orangered:\"ff4500\",orchid:\"da70d6\",palegoldenrod:\"eee8aa\",palegreen:\"98fb98\",paleturquoise:\"afeeee\",palevioletred:\"db7093\",papayawhip:\"ffefd5\",peachpuff:\"ffdab9\",peru:\"cd853f\",pink:\"ffc0cb\",plum:\"dda0dd\",powderblue:\"b0e0e6\",purple:\"800080\",red:\"f00\",rosybrown:\"bc8f8f\",royalblue:\"4169e1\",saddlebrown:\"8b4513\",salmon:\"fa8072\",sandybrown:\"f4a460\",seagreen:\"2e8b57\",seashell:\"fff5ee\",sienna:\"a0522d\",silver:\"c0c0c0\",skyblue:\"87ceeb\",slateblue:\"6a5acd\",slategray:\"708090\",slategrey:\"708090\",snow:\"fffafa\",springgreen:\"00ff7f\",steelblue:\"4682b4\",tan:\"d2b48c\",teal:\"008080\",thistle:\"d8bfd8\",tomato:\"ff6347\",turquoise:\"40e0d0\",violet:\"ee82ee\",wheat:\"f5deb3\",white:\"fff\",whitesmoke:\"f5f5f5\",yellow:\"ff0\",yellowgreen:\"9acd32\",transparent:\"0000\",rebeccapurple:\"639\"};let ps={canvas:\"fff\",canvastext:\"000\",linktext:\"001ee4\",visitedtext:\"4e2386\",activetext:\"eb3323\",buttonface:\"ddd\",buttontext:\"000\",buttonborder:\"000\",field:\"fff\",fieldtext:\"000\",highlight:\"bbd5fb\",highlighttext:\"000\",mark:\"000\",marktext:\"fff\",graytext:\"808080\"};const v=(t,e,n,r)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=r,t),R=(t,e,n,r,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=r,t[3]=s,t),pt=(t,e)=>R(t||[],(e>>>16&255)*G,(e>>>8&255)*G,(e&255)*G,(e>>>24)*G),en=(t,e)=>R(t||[],(e&255)*G,(e>>>8&255)*G,(e>>>16&255)*G,(e>>>24)*G),ws=t=>{t=(j(t)?t:t.deref()).toLowerCase();const e=_s[t]||ps[t];if(e||t[0]===\"#\")return new N(\"srgb\",pt([],Cs(e||t)));const n=t.split(/[(),/ ]+/),[r,s,i,a,o]=n;switch(_(n.length===5||n.length===6,`invalid color: ${t}`),r){case\"rgb\":case\"rgba\":return new N(\"srgb\",[$(s,1,G,!0),$(i,1,G,!0),$(a,1,G,!0),W(o)]);case\"hsl\":case\"hsla\":return new N(\"hsl\",[Xt(s),nn(i),nn(a),W(o)]);case\"lab\":return new N(\"lab50\",[$(s),$(i,1.25),$(a,1.25),W(o)]);case\"lch\":return new N(r,[$(s),$(i,1.5),Xt(a),W(o)]);case\"oklab\":return new N(r,[$(s,1,1),$(i,.4,1),$(a,.4,1),W(o)]);case\"oklch\":return new N(r,[$(s,1,1),$(i,.4,1),Xt(a),W(o)]);default:jt(`color mode: ${r}`)}},Rs={rad:M,grad:400,turn:1,deg:360},Xt=t=>{const e=/^(-?[0-9.]+)(deg|rad|grad|turn)?$/.exec(t);return _(!!e,`expected hue, got: ${t}`),p(parseFloat(e[1])/(Rs[e[2]]||360))},W=t=>t?$(t,1,1,!0):1,nn=(t,e=!0)=>{_(/^([0-9.]+)%$/.test(t),`expected percentage, got: ${t}`);const n=parseFloat(t)/100;return e?y(n):n},$=(t,e=1,n=.01,r=!1)=>{_(/^-?[0-9.]+%?$/.test(t),`expected number or percentage, got: ${t}`);const s=parseFloat(t)*(t.endsWith(\"%\")?.01*e:n);return r?y(s):s},Cs=t=>{const e=/^#?([0-9a-f]{3,8})$/i.exec(t);if(e){const n=e[1],r=parseInt(n,16);switch(n.length){case 3:return(bs(r)|4278190080)>>>0;case 4:return tn(As(r),8);case 6:return(r|4278190080)>>>0;case 8:return tn(r,8)}}return Yt(`invalid hex color: \"${t}\"`)},C=(t,e=1)=>t!=null?y(t):e,$s=t=>{if(typeof t[0]==\"number\")switch(t.length){case 1:return t.push(0,0,1),[t];case 2:return t.push(0,1),[t];case 3:return t.push(1),[t];default:return[t]}return t},wt=t=>{const e=t.channels||{},n=t.order,r=n.length;n.reduce((f,d)=>(f[d]={range:[0,1],...e[d]},f),e);const s=Object.freeze(n.map(f=>e[f].range[0])),i=Object.freeze(n.map(f=>e[f].range[1])),a=H([],s),o=H([],i);a[r-1]=1;const c=n.findIndex(f=>!!e[f].hue),l=class{constructor(f,d=0,g=1){this.offset=d,this.stride=g,this.buf=f||[0,0,0,0],this.offset=d,this.stride=g}buf;get mode(){return t.mode}get length(){return r}get range(){return[s,i]}get[Symbol.toStringTag](){return t.mode}get xyz(){return[this[0],this[1],this[2]]}[Symbol.iterator](){return us(this.buf,this.length,this.offset,this.stride)}copy(){return new l(this.deref())}copyView(){return new l(this.buf,this.offset,this.stride)}empty(){return new l}deref(){return[this[0],this[1],this[2],this[3]]}set(f){return H(this,f)}clamp(){return c>=0&&(this[c]=p(this[c])),os(null,this,s,i),this}eqDelta(f,d=I){return Xe(this,f,d)}randomize(f){return ys(this,a,o,f)}toJSON(){return this.deref()}toString(){return es(4,4)(this)}};as(l.prototype,n),Je(t.mode,t.from),Je(\"rgb\",{[t.mode]:t.toRgb});const h=(f,d,g)=>{const m=new l(...g);return d!==t.mode?Qe(m,f,t.mode,d):m.set(f)},u=(f,...d)=>f==null?new l:j(f)?u(ws(f),...d):Wt(f)?j(f.mode)?h(f,f.mode,d):new l(f,...d):Q(f,\"deref\")?h(f.deref(),f.mode,d):P(f)?d.length&&d.every(P)?new l(...$s([f,...d])):h(pt([],f),\"srgb\",d):Yt(`can't create a ${t.mode} color from: ${f}`);return u.class=l,u.range=[s,i],u.random=(f,d,g,m)=>new l(d,g,m).randomize(f),u.mapBuffer=(f,d=f.length/r|0,g=0,m=1,b=r)=>ns(l,f,d,g,m,b),u},Kt=(t,e,n=1)=>(e=p(e)*6,R(t||[],y(Math.abs(e-3)-1),y(2-Math.abs(e-2)),y(2-Math.abs(e-4)),n)),rn=(t,e)=>{const n=e[0];let r=e[1];const s=e[2],i=Kt(t||e,n,C(e[3])),a=Ht(i);return s<a?r*=s/a:a<1&&(r*=(1-s)/(1-a)),v(i,y((i[0]-a)*r+s),y((i[1]-a)*r+s),y((i[2]-a)*r+s))},Ss=(t,e,n=1)=>R(t||e,y(e[0]),y(e[1]),y(e[2]),C(e[3],n)),Rt=(t,e,n=1)=>R(t||e,p(e[0]),y(e[1]),y(e[2]),C(e[3],n)),sn=(t,e)=>{t=Rt(t||e,e);const n=t[1],r=t[2];if(n<1e-6)return v(t,r,r,r);const s=t[0]*6%6,i=r*(1-n),a=1-Math.abs(s%2-1);let o=3*r*n/(1+a);const c=o*a+i;switch(o+=i,s|0){case 0:return v(t,o,c,i);case 1:return v(t,c,o,i);case 2:return v(t,i,o,c);case 3:return v(t,i,c,o);case 4:return v(t,c,i,o);case 5:return v(t,o,i,c);default:return v(t,i,i,i)}},on=(t,e)=>{const n=y(e[1]),r=y(e[2]);t=Kt(t||e,e[0],C(e[3]));const s=(1-Math.abs(2*r-1))*n;return v(t,(t[0]-.5)*s+r,(t[1]-.5)*s+r,(t[2]-.5)*s+r)},Zt=(t,e)=>{t=Rt(t||e,e);const n=t[1],r=t[2];return Kt(t,e[0],t[3]),v(t,((t[0]-1)*n+1)*r,((t[1]-1)*n+1)*r,((t[2]-1)*n+1)*r)},Jt=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Qt=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4),Ct=(t,e)=>R(t||e,Qt(e[0]),Qt(e[1]),Qt(e[2]),C(e[3])),vs=(t,e)=>Ct(null,pt(t,e)),Bs=(t,e)=>Ct(null,en(t,e)),te=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],Ms=t=>(t%=M,t<0?M+t:t),an=(t,e)=>Ms(Math.atan2(t,e)),ee=(t,e)=>{let{1:n,2:r}=e;r*=M;const s=C(e[3]);return n>0?R(t||e,e[0],Math.cos(r)*n,Math.sin(r)*n,s):R(t||e,e[0],0,0,s)},ne=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},cn=(t,e,n=Yr)=>{const r=(e[0]+.16)/1.16;return R(t||e,ne(e[1]/5+r)*n[0],ne(r)*n[1],ne(r-e[2]/2)*n[2],C(e[3]))},ks=(t,e)=>cn(t,e,Vr),re=(t,e,n=0,r=0,s=1,i=1)=>t[n]*e[r]+t[n+s]*e[r+i]+t[n+2*s]*e[r+2*i],$t=(t,e,n,r=!1)=>{const s=re(e,n,0,0,3),i=re(e,n,1,0,3),a=re(e,n,2,0,3),o=C(n[3]);return r?R(t||n,y(s),y(i),y(a),o):R(t||n,s,i,a,o)},se=(t,e,n=Hr)=>$t(t,n,e),oe=(t,e)=>se(t,e,Wr),et=(t,e)=>se(null,cn(t,e)),ln=(t,e)=>oe(null,ks(t,e)),Gs=[4.0767416621,-1.2684380046,-.0041960863,-3.307711591,2.6097574011,-.7034186147,.2309699292,-.3413193965,1.707614701],hn=(t,{0:e,1:n,2:r,3:s})=>$t(t,Gs,[(e+.3963377774*n+.2158037573*r)**3,(e-.1055613458*n-.0638541728*r)**3,(e-.0894841775*n-1.291485548*r)**3,s]),fn=(t,e)=>e!==0?t/e:0,un=wt({mode:\"rgb\",order:[\"r\",\"g\",\"b\",\"alpha\"],from:{abgr32:(t,e)=>Bs(t,e[0]),argb32:(t,e)=>vs(t,e[0]),hcy:rn,hsi:sn,hsl:on,hsv:Zt,lab50:et,lab65:ln,lch:[ee,et],oklab:hn,rgb:H,srgb:Ct,xyy:[(t,e)=>{const{0:n,1:r,2:s}=e;return R(t||e,fn(s*n,r),s,fn(s*(1-n-r),r),C(e[3]))},oe],xyz50:se,xyz65:oe,ycc:(t,e,n=Ye)=>{const r=e[0],s=(2-2*n[2])*e[1],i=(2-2*n[0])*e[2];return R(t||e,r+i,r-n[2]/n[1]*s-n[0]/n[1]*i,r+s,C(e[3]))}},toRgb:H}),Is=(t,e)=>{const n=Ht(un(t))+.05,r=Ht(un(e))+.05;return n>r?n/r:r/n},dn=t=>{const e=_t(p(t[0])*360),n=Ve(y(t[1])),r=Ve(y(t[2])),s=C(t[3]);return s<1?`hsla(${e},${n},${r},${_t(s)})`:`hsl(${e},${n},${r})`},Us=(t,e)=>{t=Rt(t||e,e);const n=t[1],r=t[2],s=(2-n)*r/2;return t[2]=s,t[1]=s&&s<1?n*r/(s<.5?s*2:2-s*2):n,t},xs=t=>dn(Us([],t)),gn=\"0123456789abcdef\",ie=t=>gn[t>>>4&15]+gn[t&15],zs=t=>ie(t>>>8)+ie(t&255),Os=t=>ie(t>>>16)+zs(t),ae=He((t,e,n=\"\")=>{const r=qr(\"0\",e);return s=>(s=(s>>>0).toString(t),n+(s.length<e?r.substring(s.length)+s:s))});ae(2,8),ae(2,16),ae(2,32);const mn=Os,ce=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${_t(e*G)})`:`#${mn(t&16777215)}`},Es=t=>(t&255)<<16|t>>16&255|t&4278255360,Y=(t,e)=>R(t||e,Jt(e[0]),Jt(e[1]),Jt(e[2]),C(e[3])),le=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,V=t=>{const e=le(t[0]),n=le(t[1]),r=le(t[2]),s=C(t[3]);return s<1?`rgba(${e},${n},${r},${_t(s)})`:`#${mn(e<<16|n<<8|r)}`},yn={abgr32:t=>ce(Es(t[0])),argb32:t=>ce(t[0]),hsl:dn,hsv:xs,lab50:t=>V(Y(null,et([],t))),lab65:t=>V(Y(null,ln([],t))),lch:t=>V(Y(null,et(null,ee([],t)))),rgb:t=>V(Y([],t)),srgb:V};({...yn});let Fs=yn;const bn=(t,e=Fs)=>{let n;return j(t)?t:P(t)?ce(t):t.mode?(n=e[t.mode])?n(t):e.rgb(Qe([],t,\"rgb\",t.mode)):V(t)},Ts=(t,e)=>{t=Rt(t||e,e);const n=t[1],r=t[2],s=2*r,i=(s+n*(1-Math.abs(s-1)))*.5;return t[1]=2*(i-r)/i,t[2]=i,t},Ds=(t,e)=>{t=Ss(t||e,e);const n=t[1]<t[2]?[t[2],t[1],-1,2/3]:[t[1],t[2],0,-1/3],r=t[0]<n[0]?[n[0],n[1],n[3],t[0]]:[t[0],n[1],n[2],n[0]],s=r[0]-Math.min(r[1],r[3]);return v(t,y(Math.abs((r[3]-r[1])/(6*s+I)+r[2])),y(s),y(r[0]))},he=(t,e)=>(t=Ds(t,e),t[1]/=t[2]+I,t),Ns=wt({mode:\"hsv\",channels:{h:{hue:!0}},order:[\"h\",\"s\",\"v\",\"alpha\"],from:{rgb:he,srgb:he,hsl:Ts,lch:[ee,et,Y,he]},toRgb:Zt}),St=(t,e=1)=>{const n=(a,o,c)=>{!a&&(a=o);for(let l=o.length;l-- >0;)a[l]=t(o[l],c);return a},r=(a,o,c)=>(!a&&(a=o),a[0]=t(o[0],c),a[1]=t(o[1],c),a),s=(a,o,c)=>(!a&&(a=o),a[0]=t(o[0],c),a[1]=t(o[1],c),a[2]=t(o[2],c),a),i=(a,o,c)=>(!a&&(a=o),a[0]=t(o[0],c),a[1]=t(o[1],c),a[2]=t(o[2],c),a[3]=t(o[3],c),a);return[k(e,n,r,s,i),r,s,i]},[_i,pi,qs]=St(Math.pow),Ps=qs,js=[.4122214708,.2119034982,.0883024619,.5363325363,.6806995451,.2817188376,.0514459929,.1073969566,.6299787005],Ls=(t,e)=>$t(null,Xr,Ps(null,$t(t,js,e),1/3)),An=(t,e)=>R(t||e,e[0],Math.hypot(e[1],e[2]),an(e[2],e[1])*Sr,C(e[3])),Hs=wt({mode:\"oklch\",channels:{c:{range:[0,.3225]}},order:[\"l\",\"c\",\"h\",\"alpha\"],from:{oklab:An,rgb:(t,e)=>An(null,Ls(t,e))},toRgb:[(t,e)=>R(t||e,e[0],...te(e[2]*M,e[1]),C(e[3])),hn]}),_n=wt({mode:\"srgb\",order:[\"r\",\"g\",\"b\",\"alpha\"],from:{abgr32:(t,e)=>en(t,e[0]),argb32:(t,e)=>pt(t,e[0]),hcy:rn,hsi:sn,hsl:on,hsv:Zt,rgb:Y},toRgb:Ct}),Ws=(t,e)=>t===e?0:t==null?e==null?0:-1:e==null?t==null?0:1:typeof t.compare==\"function\"?t.compare(e):typeof e.compare==\"function\"?-e.compare(t):t<e?-1:t>e?1:0,Ys=t=>typeof t==\"function\"?t:e=>e[t];function pn(t,e=Ws){const n=Ys(t);return(r,s)=>e(n(r),n(s))}const Vs=(t,e)=>e-t,fe=(t,e=1,n=!0)=>{const r=n?(o,c,l)=>{!o&&(o=c);for(let h=c.length;h-- >0;)o[h]=t(c[h],l[h]);return o}:(o,c,l)=>{!o&&(o=l);for(let h=c.length;h-- >0;)o[h]=t(c[h],l[h]);return o},s=n?(o,c,l)=>(!o&&(o=c),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o):(o,c,l)=>(!o&&(o=l),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o),i=n?(o,c,l)=>(!o&&(o=c),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o[2]=t(c[2],l[2]),o):(o,c,l)=>(!o&&(o=l),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o[2]=t(c[2],l[2]),o),a=n?(o,c,l)=>(!o&&(o=c),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o[2]=t(c[2],l[2]),o[3]=t(c[3],l[3]),o):(o,c,l)=>(!o&&(o=l),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o[2]=t(c[2],l[2]),o[3]=t(c[3],l[3]),o);return[k(e,r,s,i,a),s,i,a]},Xs=(t,e)=>t+e,Ks=(t,e)=>t*e,Zs=(t,e)=>t-e,[Js,Qs]=fe(Xs),wn=Js,to=Qs,eo=Object.freeze([0,0]),no=Object.freeze([0,0,0]),Rn=Math.cos,Cn=Math.sin,$n=k(1);$n.add(2,(t,e,n=eo)=>to(t||e,te(e[1],e[0]),n)),$n.add(3,(t,e,n=no)=>{const r=e[0],s=e[1],i=e[2],a=Rn(s);return v(t||e,r*a*Rn(i)+n[0],r*a*Cn(i)+n[1],r*Cn(s)+n[2])});const ro=(t,e)=>{const n=[];for(let r of t)n.push(te(r,e));return n},so=t=>_(t.length>0,\"no inputs given\"),[oo]=St(Ks),Sn=oo,io=k(0,t=>{let e=0;for(let n=t.length;n-- >0;)e+=t[n];return e},t=>t[0]+t[1],t=>t[0]+t[1]+t[2],t=>t[0]+t[1]+t[2]+t[3]),ao=(t,e)=>{so(e),t=Qr(t||[],e[0]);for(let n=e.length;n-- >1;)wn(t,t,e[n]);return Sn(t,t,1/e.length)},ue=t=>t.length>0?io(t)/t.length:0,[co]=St(Zs),lo=co,vn=(t,e)=>lo(t,e,ue(e)),ho=t=>an(t[1],t[0]),fo=k(0,t=>{let e=0;for(let n=t.length;n-- >0;)e+=t[n]*t[n];return e},t=>t[0]*t[0]+t[1]*t[1],t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]),uo=(t,e=!1,n=!1)=>{const r=~~n;return t.length>r?fo(e?t:vn([],t))/(t.length-r):0},de=(t,e=!1,n=!1)=>Math.sqrt(uo(t,e,n)),ge=t=>ho(ao([],ro(t))),go=(t,e)=>{const n=ge(e);!t&&(t=[]);for(let r=0,s=e.length;r<s;r++)t[r]=(e[r]-n+Ee)%M;return vn(null,t)},mo=(t,e)=>de(go([],t),!0,e);fe(Math.max);const yo=t=>{let e=-1/0;for(let n=t.length;n-- >0;)e=Math.max(e,t[n]);return e},me=t=>{if(!t.length)return 0;const e=t.length,n=e>>1;return t=[...t].sort((r,s)=>r-s),e&1?t[n]:(t[n-1]+t[n])*.5};fe(Math.min);const bo=t=>{let e=1/0;for(let n=t.length;n-- >0;)e=Math.min(e,t[n]);return e},Ao=t=>{const[e,n]=be(t);return{min:e,max:n,mean:ue(t),median:me(t),sd:de(t)}},ye=(t,e)=>{const[n,r]=be(t);return{min:n,max:r,mean:ue(t),median:me(t),sd:de(t),weighted:Nr(t,e)}},_o=t=>{const e=t.map(i=>i*M),n=p(ge(e)/M),[r,s]=po(t,n);return{min:r,max:s,mean:n,median:wo(t,r,s),sd:mo(e)/M}},be=t=>[bo(t),yo(t)],po=(t,e)=>{const n=be(t),[r,s]=n;return e<r||e>s?[t.reduce((i,a)=>{const o=p(e-a);return o<.5&&o>i[1]?[a,o]:i},[s,p(e-s)])[0],t.reduce((i,a)=>{const o=p(a-e);return o<.5&&o>i[1]?[a,o]:i},[r,p(r-e)])[0]]:n},wo=(t,e,n)=>{if(e<=n)return me(t);const r=t.length,s=r>>1,i=[...t].sort((c,l)=>c-l),a=i.findIndex(c=>c===e),o=i.slice(a).concat(i.slice(0,a));return r&1?o[s]:(o[s-1]+o[s])*.5},Ro=t=>typeof t==\"function\",Co=k(0,(t,e)=>{let n=0;for(let r=t.length;r-- >0;){const s=t[r]-e[r];n+=s*s}return n},(t,e)=>{const n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},(t,e)=>{const n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return n*n+r*r+s*s},(t,e)=>{const n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return n*n+r*r+s*s+i*i});class $o{constructor(e){this.metric=e}to(e){return e*e}from(e){return Math.sqrt(e)}}const Ae=new $o(Co),Bn=(t,e,n=Ae)=>{const r=Ro(n)?n:n.metric;let s=1/0,i=-1;for(let a=0,o=e.length;a<o;a++){const c=r(t,e[a]);c<s&&(s=c,i=a)}return i};k(0,(t,e)=>{for(let n=t.length;n-- >0;)t[n]=e;return t},(t,e)=>(t[0]=e,t[1]=e,t),(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t),(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t[3]=e,t));const So=t=>Array(t).fill(0),vo=t=>Array(t).fill(1),Bo=(t,e,n={})=>{let{dim:r=e[0].length,dist:s=Ae,maxIter:i=32,strategy:a=Io,exponent:o,initial:c,rnd:l}=n;const h=e.length,u=Array.isArray(c)?c:c?c(t,e,s,l):Mo(t,e,s,l,o);_(u.length>0,\"missing initial centroids\"),t=u.length;const f=new Uint32Array(h).fill(t);let d=!0;for(;d&&i-- >0&&(d=ko(e,u,f,s),!!d);)for(let g=0;g<t;g++){const m=a(r);for(let A=0;A<h;A++)g===f[A]&&m.update(e[A]);const b=m.finish();b&&(u[g]=b)}return Go(u,f)},Mo=(t,e,n=Ae,r=Vt,s=2)=>{const i=e.length;_(i>0,\"missing samples\"),t=Math.min(t,i);const a=[r.int()%i],o=[e[a[0]]],c=new Array(i).fill(0).map((h,u)=>u),l=n.metric;for(;a.length<t;){let h=0;const u=e.map(d=>{const g=n.from(l(d,o[Bn(d,o,n)]))**s;return h+=g,g});if(!h)break;let f;do f=ms(c,u,r)();while(a.includes(f));a.push(f),o.push(e[f])}return o},ko=(t,e,n,r)=>{let s=!1;for(let i=t.length;i-- >0;){const a=Bn(t[i],e,r);a!==n[i]&&(n[i]=a,s=!0)}return s},Go=(t,e)=>{const n=[];for(let r=0,s=e.length;r<s;r++){const i=e[r];(n[i]||(n[i]={id:i,centroid:t[i],items:[]})).items.push(r)}return n.filter(r=>!!r)},Io=t=>{const e=So(t);let n=0;return{update:r=>{wn(e,e,r),n++},finish:()=>n?Sn(e,e,1/n):void 0}},Uo=(t,e)=>{const n=[];let r=0;for(let s of e)t(s,r)&&n.push(s),r++;return n},Mn=(t,e,n)=>{const r=n?.filter?Uo(n.filter,t):Array.isArray(t)?t:[...t];return r.length?Bo(Math.min(e,r.length),r,n).sort((s,i)=>i.items.length-s.items.length).map(s=>({color:[...s.centroid],area:s.items.length/r.length,ids:s.items})):[]},_e=t=>typeof t?.[Symbol.iterator]==\"function\",kn=(t,e)=>[t[0],t[1],e],pe=Symbol(),Gn=()=>{},vt=t=>Q(t,\"xform\")?t.xform():t,xo=it(()=>\"illegal arity\"),we=t=>{throw new xo(t)};class Bt{value;constructor(e){this.value=e}deref(){return this.value}}const X=t=>t instanceof Bt,zo=t=>t instanceof Bt?t:new Bt(t),nt=t=>t instanceof Bt?t.deref():t,Oo=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:we(t.length);function Mt(...t){const e=t[0],n=e[0],r=e[1],s=e[2];t=Oo(t);const i=t[0]==null?n():t[0],a=t[1];return nt(r(Q(a,\"$reduce\")?a.$reduce(s,i):Wt(a)?Eo(s,i,a):Fo(s,i,a)))}const Eo=(t,e,n)=>{for(let r=0,s=n.length;r<s;r++)if(e=t(e,n[r]),X(e)){e=e.deref();break}return e},Fo=(t,e,n)=>{for(let r of n)if(e=t(e,r),X(e)){e=e.deref();break}return e},Re=(t,e)=>[t,at,e],kt=(t,e)=>{const n=e.length-1;return _e(e[n])?e.length>1?Mt(t.apply(null,e.slice(0,n)),e[n]):Mt(t(),e[0]):void 0};function In(t){return t?[...t]:Re(()=>[],(e,n)=>(e.push(n),e))}function*To(t,e){const n=vt(t)(In()),r=n[1],s=n[2];for(let i of e){const a=s([],i);if(X(a)){yield*nt(r(a.deref()));return}a.length&&(yield*a)}yield*nt(r([]))}function*Do(t,e){const n=vt(t)([Gn,Gn,(r,s)=>s])[2];for(let r of e){let s=n(pe,r);if(X(s)){s=nt(s.deref()),s!==pe&&(yield s);return}s!==pe&&(yield s)}}function rt(t,e){return _e(e)?Do(rt(t),e):n=>{const r=n[2];return kn(n,(s,i)=>r(s,t(i)))}}function Un(t){return t?Mt(Un(),t):Re(()=>-1/0,(e,n)=>Math.max(e,n))}const xn=t=>((t==null||!t[Symbol.iterator])&&Yt(`value is not iterable: ${t}`),t),No=t=>Ze(t)?t:[...xn(t)],qo=t=>Wt(t)?t:[...xn(t)];function*Po(...t){const e=t.length-1;if(e<0)return;const n=new Array(e+1).fill(0),r=t.map(qo),s=r.reduce((i,a)=>i*a.length,1);for(let i=0;i<s;i++){const a=[];for(let o=e;o>=0;o--){const c=r[o];let l=n[o];l===c.length&&(n[o]=l=0,o>0&&n[o-1]++),a[o]=c[l]}n[e]++,yield a}}function Ce(...t){return jo(Ce,Mt,t)}const jo=(t,e,n)=>{let r,s;switch(n.length){case 4:s=n[3],r=n[2];break;case 3:s=n[2];break;case 2:return rt(i=>t(n[0],n[1],i));default:we(n.length)}return e(vt(n[0])(n[1]),r,s)},[Lo]=St(De),Ho=Lo,zn=(t,e,n)=>Wo(y((n-t)/(e-t))),Wo=t=>t*t*(3-2*t);function On(...t){let[e,n,r,s,i,a,o,c,l,h]=t;switch(t.length){case 0:we(0);case 1:return e;case 2:return(...f)=>e(n(...f));case 3:return(...f)=>e(n(r(...f)));case 4:return(...f)=>e(n(r(s(...f))));case 5:return(...f)=>e(n(r(s(i(...f)))));case 6:return(...f)=>e(n(r(s(i(a(...f))))));case 7:return(...f)=>e(n(r(s(i(a(o(...f)))))));case 8:return(...f)=>e(n(r(s(i(a(o(c(...f))))))));case 9:return(...f)=>e(n(r(s(i(a(o(c(l(...f)))))))));case 10:default:const u=(...f)=>e(n(r(s(i(a(o(c(l(h(...f))))))))));return t.length===10?u:On(u,...t.slice(10))}}function Yo(...t){return t=t.map(vt),On.apply(null,t)}function En(...t){const e=kt(En,t);if(e!==void 0)return e;const[n=0,r=1]=t;return Re(()=>n,(s,i)=>s+r)}const Vo=t=>t,Xo=t=>({key:e=>e,group:In(),...t});function Fn(...t){const e=kt(Fn,t);if(e!==void 0)return e;const n=Xo(t[0]),[r,s,i]=n.group;return[()=>new Map,a=>{for(let o of a.keys())a.set(o,s(a.get(o)));return a},(a,o)=>{const c=n.key(o);return a.set(c,a.has(c)?i(a.get(c),o):i(r(),o))}]}function Tn(...t){return kt(Tn,t)||Fn({key:t[0]||Vo,group:En()})}function Dn(...t){const e=kt(Dn,t);if(e!==void 0)return e;const[n,r,s]=Tn(...t);let i=0;return[n,a=>{a=r(a);for(let o of a)a.set(o[0],o[1]/i);return a},(a,o)=>(i++,s(a,o))]}const Ko=()=>t=>{const e=t[2];return kn(t,(n,r)=>{if(r){for(let s of nt(r)||[])if(n=e(n,s),X(n))break}return X(r)?zo(n):n})};function Nn(t,e){return _e(e)?To(Nn(t),e):Yo(rt(t),Ko())}function*Zo(t,e=1/0){for(;e-- >0;)yield t}const qn=(t,e=.2,n)=>{const r=No(t),s=r.filter(u=>u[1]>=e),i=s.length/r.length,a=[...Ce(rt(u=>De(u[0],1/12)%1),Dn(),s)].sort(pn(0)),o=[...Nn(([u,f])=>(f*=50,f>=1?Zo(u*M,f):null),a)];if(!o.length)return{hues:a,meanHue:0,temp:0,areaTemp:0,area:0};const c=ge(o)/M,l=Qo(c,n),h=l*i;return{hues:a,meanHue:c,temp:l,areaTemp:h,area:i}},Jo=[.1,.6,.72,.92],Qo=(t,[e,n,r,s]=Jo)=>2*(t<2/3?zn(n,e,t):zn(r,s,t))-1,ti=(t,e)=>{let n=t.format!==L?t.as(L):t;e?.size&&(n=ri(n,e.size));const r=n.as(xe),s=n.as(Fr),i=ni(n,e),a=i.map(l=>l.area),o=ei(i.map(l=>l.color),a,e?.minSat,e?.tempCoeffs),c=Ao(r.data);return{...o,img:n,imgGray:r,imgHsv:s,lumImg:c,temperature:qn(s,e?.minSat,e?.tempCoeffs),contrastImg:c.max-c.min}},ei=(t,e=vo(t.length),n,r)=>{const s=t.map(f=>Kr(f)),i=t.map(f=>_n(f)),a=i.map(f=>Ns(f)),o=i.map(f=>Hs(f)),c=i.map(f=>bn(f)),l=a.map(f=>f[0]),h=a.map(f=>f[1]),u=ye(s,e);return{css:c,srgb:i,hsv:a,oklch:o,hue:_o(l),sat:ye(h,e),chroma:ye(o.map(f=>f[1]),e),lum:u,areas:e,contrast:u.max-u.min,colorContrast:Or(Ce(rt(f=>Is(...f)),Un(),Po(i,i)),1,21,0,1),temperature:qn(a,n,r)}},ni=(t,{dominantFn:e=Mn,numColors:n=4,prec:r=.001}={})=>e(t,n).sort(pn(\"area\",Vs)).map(s=>(Ho(null,s.color,r),s)),ri=(t,e)=>{e=~~e;let n=t.width,r=t.height;return[n,r]=n>r?[e,~~Math.max(1,r/n*e)]:[~~Math.max(1,n/r*e),e],t.resize(n,r)};/**\n * Options for extracting colors / evaluating lightness from an image.\n *\n * @typedef {Object} ImageAnalysisSettings\n * @property {number} [numColors=2] - Number of dominant colors to return.\n * @property {number} [lightnessThreshold=0.5] - Threshold (0.0 - 1.0) used to decide if a color is considered \"light\".\n * @property {number} [yFrom=0.0] - Minimum Y (luminance) value (0.0 - 1.0) to include when evaluating lightness.\n * @property {number} [yTo=1.0] - Maximum Y (luminance) value (0.0 - 1.0) to include when evaluating lightness.\n * @property {number} [maxSize=320] - Maximum width/height to scale down the image to before analysis, for performance.\n * @property {number} [alphaThreshold=30] - Threhold (0-255) below which a pixel is considered \"transparent\" for the purposes of analysis.\n *\n * @preserve\n */const si={numColors:3,lightnessThreshold:.5,yFrom:0,yTo:1,maxSize:320,alphaThreshold:30};/**\n * Check image transparency by analyzing pixel alpha values.\n *\n * @param {Uint8ClampedArray} imageData - The image data array containing RGBA values.\n * @param {number} w - The width of the image.\n * @param {number} h - The height of the image.\n * @param {ImageAnalysisSettings} [settings] - Optional settings to customize the transparency check.\n *\n * @return {{ any: boolean, left: boolean, right: boolean, top: boolean, bottom: boolean }} An object indicating transparency on different sides of the image.\n *\n * @preserve\n */const oi=(t,e,n,r={})=>{const{alphaThreshold:s}={...si,...r},i={any:!0,left:!0,right:!0,top:!0,bottom:!0};let a={any:0,left:0,right:0,top:0,bottom:0};const o=Math.floor(.15*e),c=Math.floor((n>100?.05:.5)*n),l=Math.floor(e*n*.001);if(e>0&&n>0){for(let h=0;h<e;h++){const u=(0*e+h)*4+3;if(t[u]>s&&(a.top++,a.top>=o)){i.top=!1;break}}for(let h=0;h<e;h++){const u=((n-1)*e+h)*4+3;if(t[u]>s&&(a.bottom++,a.bottom>=o)){i.bottom=!1;break}}for(let h=0;h<n;h++){const u=(h*e+0)*4+3;if(t[u]>s&&(a.left++,a.left>=c)){i.left=!1;break}}for(let h=0;h<n;h++){const u=(h*e+(e-1))*4+3;if(t[u]>s&&(a.right++,a.right>=c)){i.right=!1;break}}if(!i.top&&!i.bottom&&!i.left&&!i.right){for(let h=3;h<t.length;h+=4)if(t[h]>s&&(a.any++,a.any>=l)){i.any=!1;break}}else i.any=!0}return i};/**\n * Determine if a color is considered \"dark\" based on its RGB values and a lightness threshold.\n *\n * @param {number} r - Red component (0-255).\n * @param {number} g - Green component (0-255).\n * @param {number} b - Blue component (0-255).\n * @param {number} [threshold=0.5] - Lightness threshold (0.0 - 1.0) below which the color is considered dark.\n *\n * @returns {boolean} True if the color is dark, false otherwise.\n *\n * @example\n * isColorDark(0, 0, 0); // true (black)\n * isColorDark(255, 255, 255); // false (white)\n * isColorDark(100, 100, 100, 0.4); // false (gray with higher threshold)\n *\n * @preserve\n */const ii=(t,e,n,r=.5)=>(.299*t+.587*e+.114*n)/255<r,ai=({buffer:t,imageData:e,width:n,height:r,settings:s,skipTransparencyCheck:i=!1})=>{const{numColors:a,lightnessThreshold:o}=s,c=ti(t,{numColors:a,dominantFn:(d,g)=>Mn(d,g,{filter:m=>_n(m).alpha>0}),prec:.01}),{lumImg:l,srgb:h,areas:u}=c;let f=!1;return!i&&e&&(f=oi(e,n,r,s)),{isDark:l.mean<o,isTransparent:i?!1:f?.any,transparencyInfo:i?null:f,dominantColors:h.map(({r:d,g,b:m},b)=>({color:bn([d,g,m]),area:u?.[b],isDark:ii(d*255,g*255,m*255,o)}))}},q=new Map,ci=50,Pn=(t,e)=>{const n=JSON.stringify({numColors:e?.numColors??3,lightnessThreshold:e?.lightnessThreshold??.5,yFrom:e?.yFrom??0,yTo:e?.yTo??1,maxSize:e?.maxSize??320,alphaThreshold:e?.alphaThreshold??30});return`${t}::${n}`};self.onmessage=async t=>{const{imageBitmap:e,settings:n,imageSource:r}=t.data;try{if(r){const i=Pn(r,n),a=q.get(i);if(a){q.delete(i),q.set(i,a),self.postMessage({success:!0,data:a});return}}const s=await li(e,n);if(r&&s){const i=Pn(r,n);if(q.size>=ci){const a=q.keys().next().value;q.delete(a)}q.set(i,s)}self.postMessage({success:!0,data:s})}catch(s){self.postMessage({success:!1,error:s.message,stack:s.stack})}};async function li(t,e){const r={...{numColors:3,lightnessThreshold:.5,yFrom:0,yTo:1,maxSize:320,alphaThreshold:30},...e},{yFrom:s,yTo:i,maxSize:a}=r,o=t.width,c=t.height;if(!o||!c)return!1;let l=1;(o>a||c>a)&&(l=Math.min(a/o,a/c));const h=Math.floor(o*l),u=Math.floor(c*l),f=0,d=Math.floor(s*c),g=Math.max(1,o),m=Math.max(1,Math.ceil((i-s)*c)),b=Math.max(1,h),A=Math.max(1,Math.ceil((i-s)*u)),E=new OffscreenCanvas(b,A);E.getContext(\"2d\").drawImage(t,f,d,g,m,0,0,b,A);const Gt=xr(E,L),jn=new OffscreenCanvas(h,u).getContext(\"2d\");jn.drawImage(t,0,0,o,c,0,0,h,u);const hi=jn.getImageData(0,0,h,u).data;return ai({buffer:Gt,imageData:hi,width:h,height:u,settings:r})}})();\n";
