// AUTO-GENERATED FILE. DO NOT EDIT.
// Run the build-worker script to update.
export default "(function(){\"use strict\";var w=(t=>(t[t.ALPHA=0]=\"ALPHA\",t[t.BLUE=1]=\"BLUE\",t[t.GREEN=2]=\"GREEN\",t[t.RED=3]=\"RED\",t))(w||{});const Be=[\"rotateCW\",\"rotate180\",\"rotateCCW\"],Vn=(t,e=t,n,r={})=>{const s=document.createElement(\"canvas\");return Kn(s,t,e,r.dpr),r.pixelated&&(s.style.imageRendering=\"pixelated\"),{canvas:s,ctx:s.getContext(\"2d\",r.ctx)}},Xn=(t,e=t,n,r)=>Vn(t,e,n,{dpr:1,...r}),Kn=(t,e,n,r=window.devicePixelRatio||1)=>(r!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*r,t.height=n*r,r),q=t=>typeof t==\"number\";function Zn(t,e,n,r){let s,i;if(q(t)){const c=Xn(t,e,n,r);s=c.canvas,i=c.ctx}else s=t,i=s.getContext(\"2d\");const a=i.getImageData(0,0,s.width,s.height),o=new Uint32Array(a.data.buffer);return{canvas:s,ctx:i,img:a,data:o}}const ct=(t,e,n)=>{n.configurable=!1},lt=(t,e={})=>{const n=Reflect.ownKeys(t),r=Reflect.ownKeys(e),s=Symbol(\"isa\");function i(a){for(let o of n){const c=Object.getOwnPropertyDescriptor(a.prototype,o);(!c||c.configurable)&&Object.defineProperty(a.prototype,o,{value:t[o],writable:!0})}return Object.defineProperty(a.prototype,s,{value:!0}),a}for(let a of r)Object.defineProperty(i,a,{value:e[a],enumerable:e.propertyIsEnumerable(a)});return Object.defineProperty(i,Symbol.hasInstance,{value:a=>!!a[s]}),i};lt({order(){return[0]},includes(t){return t>=0&&t<this.size[0]},indexAt(t){return this.includes(t)?this.indexAtUnsafe(t):-1},indexAtUnsafe(t){return this.offset+(t|0)*this.stride[0]},getAt(t){return this.includes(t)?this.data[this.indexAtUnsafe(t)]:0},getAtUnsafe(t){return this.data[this.indexAtUnsafe(t)]},setAt(t,e){return this.includes(t)?(this.data[this.indexAtUnsafe(t)]=e,!0):!1},setAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t)]=e,!0}});const ke=lt({order(){return Math.abs(this.stride[1])>Math.abs(this.stride[0])?[1,0]:[0,1]},includes(t,e){const n=this.size;return t>=0&&t<n[0]&&e>=0&&e<n[1]},indexAt(t,e){return this.includes(t,e)?this.indexAtUnsafe(t,e):-1},indexAtUnsafe(t,e){return this.offset+(t|0)*this.stride[0]+(e|0)*this.stride[1]},getAt(t,e){return this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)]:0},getAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t,e)]},setAt(t,e,n){return this.includes(t,e)?(this.data[this.indexAtUnsafe(t,e)]=n,!0):!1},setAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e)]=n,!0}});lt({order(){return Ge(this.stride)},includes(t,e,n){const r=this.size;return t>=0&&t<r[0]&&e>=0&&e<r[1]&&n>=0&&n<r[2]},indexAt(t,e,n){return this.includes(t,e,n)?this.indexAtUnsafe(t,e,n):-1},indexAtUnsafe(t,e,n){const r=this.stride;return this.offset+(t|0)*r[0]+(e|0)*r[1]+(n|0)*r[2]},getAt(t,e,n){return this.includes(t,e,n)?this.data[this.indexAtUnsafe(t,e,n)]:0},getAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e,n)]},setAt(t,e,n,r){return this.includes(t,e,n)?(this.data[this.indexAtUnsafe(t,e,n)]=r,!0):!1},setAtUnsafe(t,e,n,r){return this.data[this.indexAtUnsafe(t,e,n)]=r,!0}}),lt({order(){return Ge(this.stride)},includes(t,e,n,r){const s=this.size;return t>=0&&t<s[0]&&e>=0&&e<s[1]&&n>=0&&n<s[2]&&r>=0&&r<s[3]},indexAt(t,e,n,r){return this.includes(t,e,n,r)?this.indexAtUnsafe(t,e,n,r):-1},indexAtUnsafe(t,e,n,r){const s=this.stride;return this.offset+(t|0)*s[0]+(e|0)*s[1]+(n|0)*s[2]+(r|0)*s[3]},getAt(t,e,n,r){return this.includes(t,e,n,r)?this.data[this.indexAtUnsafe(t,e,n,r)]:0},getAtUnsafe(t,e,n,r){return this.data[this.indexAtUnsafe(t,e,n,r)]},setAt(t,e,n,r,s){return this.includes(t,e,n,r)?(this.data[this.indexAtUnsafe(t,e,n,r)]=s,!0):!1},setAtUnsafe(t,e,n,r,s){return this.data[this.indexAtUnsafe(t,e,n,r)]=s,!0}});const Ge=t=>[...t].map((e,n)=>[e,n]).sort((e,n)=>Math.abs(n[0])-Math.abs(e[0])).map(e=>e[1]),P=t=>typeof t==\"string\",ht=(t,e=n=>n!==void 0?\": \"+n:\"\")=>class extends Error{origMessage;constructor(n){super(t(n)+e(n)),this.origMessage=n!==void 0?String(n):\"\"}},Jn={};var Me={};const Qn=ht(()=>\"Assertion failed\"),A=(typeof process<\"u\"&&Me!==void 0?Me.UMBRELLA_ASSERTS:!Jn)?(t,e)=>{if(typeof t==\"function\"&&!t()||!t)throw new Qn(typeof e==\"function\"?e():e)}:()=>{},B=(t,e,n)=>t<e?e:t>n?n:t,m=t=>t<0?0:t>1?1:t,Ue=(t,e,n,r,s)=>(t[0]=e,t[1]=n,t[2]=r,t[3]=s,t),tr=(t,e)=>{const n=e[3];return Ue(e,e[0]*n,e[1]*n,e[2]*n,n)},er=t=>{const e=(t>>>24)/255;return t&4278190080|(t>>>16&255)*e<<16|(t>>>8&255)*e<<8|(t&255)*e},nr=(t,e)=>{const n=e[3];return n>0?Ue(e,e[0]/n,e[1]/n,e[2]/n,n):e},rr=t=>{const e=(t>>>24)/255;return e>0?(t&4278190080|Math.min(255,(t>>>16&255)/e)<<16|Math.min(255,(t>>>8&255)/e)<<8|Math.min(255,(t&255)/e))>>>0:t},sr=t=>{const e=t[3];return t[0]<=e&&t[1]<=e||t[2]<=e},or=t=>{const e=t>>>24;return(t>>>16&255)<=e&&(t>>>8&255)<=e&&(t&255)<=e},Ie=(t,e,n,r=1)=>A(t.length>=e*n*r,\"pixel buffer too small\"),xe=(t,e,n)=>t?(zt(t,e,n),t):new ImageData(e,n),zt=(t,e,n)=>A(t.width===e&&t.height===n,\"imagedata has wrong dimensions\"),O=(t,e)=>{const n=t.channels[e];return A(n!=null,`invalid channel ID: ${e}`),n},ir=t=>A(!!t.alpha,\"missing alpha channel\"),ft=t=>t,Ot=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/255,ut=(t,e,n,r,s,i,a=0,o=0)=>(t|=0,e|=0,n|=0,r|=0,t<0&&(n+=t,a-=t,t=0),e<0&&(r+=e,o-=e,e=0),[t,e,B(n,0,s-t),B(r,0,i-e),a,o]),dt=(t,e,n={})=>{const r=t.width,s=e.width;let i,a,o,c,l,h;return[i,a,l,h]=ut(n.sx||0,n.sy||0,n.w||r,n.h||t.height,r,t.height),[o,c,l,h,i,a]=ut(n.dx||0,n.dy||0,l,h,s,e.height,i,a),{sx:i,sy:a,dx:o,dy:c,rw:l,rh:h}},ar=(t,e,n)=>{for(let r=t.length;r-- >0;)t[r]=n(t[r],e)},cr=(t,e,n,r)=>{for(let s=t.length;s-- >0;)t[s]=r(t[s],n(e[s]))},lr=(t,e,n,r,s)=>{const i=~s;for(let a=t.length;a-- >0;)t[a]=t[a]&i|n(r(e[a]))&s},ze=(t,e,n)=>{const r=e.fromABGR,s=e.toABGR;for(let i=t.length;i-- >0;)t[i]=r(n(s(t[i])))},Oe=(t,e,n={})=>(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext(\"2d\"):e).putImageData(t.toImageData(n.data),n.x||0,n.y||0),gt=t=>{const e=t.channels,n=e.reduce((a,o)=>(a[o]=3-o<<3,a),{}),r={...t,__float:!0,size:e.length,shift:n,range:[0,1],normalized:m,fromNormalized:ft};if(t.convert)return Object.assign(r,t.convert),r;const s=(a,o)=>(m(a[o])*255+.5|0)<<n[e[o]],i=(a,o)=>(a>>>n[e[o]]&255)/255;switch(e.length){case 1:t.gray?fr(r):hr(r,i,s);break;case 2:t.gray?dr(r,i):ur(r,i,s);break;case 3:gr(r,i,s);break;case 4:mr(r,i,s);break}return r},hr=(t,e,n)=>{t.toABGR=r=>{let s=t.alpha?0:4278190080;return s|=n(r,0),s>>>0},t.fromABGR=(r,s=[])=>(s[0]=e(r,0),s)},fr=t=>{t.toABGR=e=>((m(e[0])*255+.5|0)*65793|4278190080)>>>0,t.fromABGR=(e,n=[])=>(n[0]=Ot(e)/255,n)},ur=(t,e,n)=>{t.toABGR=r=>{let s=t.alpha?0:4278190080;return s|=n(r,0),s|=n(r,1),s>>>0},t.fromABGR=(r,s=[])=>(s[0]=e(r,0),s[1]=e(r,1),s)},dr=(t,e)=>{const n=~~(t.channels[0]===w.ALPHA),r=n^1;t.toABGR=s=>{let i=(m(s[n])*255+.5|0)*65793;return i|=(s[r]*255+.5|0)<<24,i>>>0},t.fromABGR=(s,i=[])=>(i[n]=Ot(s)/255,i[r]=e(s,r),i)},gr=(t,e,n)=>{t.toABGR=r=>{let s=t.alpha?0:4278190080;return s|=n(r,0),s|=n(r,1),s|=n(r,2),s>>>0},t.fromABGR=(r,s=[])=>(s[0]=e(r,0),s[1]=e(r,1),s[2]=e(r,2),s)},mr=(t,e,n)=>{t.toABGR=r=>{let s=t.alpha?0:4278190080;return s|=n(r,0),s|=n(r,1),s|=n(r,2),s|=n(r,3),s>>>0},t.fromABGR=(r,s=[])=>(s[0]=e(r,0),s[1]=e(r,1),s[2]=e(r,2),s[3]=e(r,3),s)},Ee=gt({gray:!0,channels:[w.RED]}),br={5120:\"i8\",5121:\"u8\",5122:\"i16\",5123:\"u16\",5124:\"i32\",5125:\"u32\",5126:\"f32\"},yr={f32:Float32Array,f64:Float64Array},Ar={i8:Int8Array,i16:Int16Array,i32:Int32Array},_r={u8:Uint8Array,u8c:Uint8ClampedArray,u16:Uint16Array,u32:Uint32Array},pr={i64:BigInt64Array,u64:BigUint64Array},wr={...yr,...Ar,..._r},Rr=t=>{const e=br[t];return e!==void 0?e:t};function mt(t,...e){const n=pr[t];return new(n||wr[Rr(t)])(...e)}const $r=t=>t>16?\"u32\":t>8?\"u16\":\"u8\",Et=(t,e)=>e>0?`(${t} << ${e})`:e<0?`(${t} >>> ${-e})`:`${t}`,Ft=(t,e)=>Et(t,-e),Fe=t=>`0x${t.toString(16)}`,Cr=t=>{const e=8-t,n=(1<<t)-1;return new Function(\"luma\",`return (x) => ${Ft(\"luma(x)\",e)} & ${n};`)(Ot)},vr=t=>{let e;if(t!==8){const n=(1<<t)-1,r=255/n;e=`(((x & ${n}) * ${r}) | 0)`}else e=\"x\";return new Function(\"x\",`return 0xff000000 | (${e} * 0x010101);`)},Sr=t=>new Function(\"x\",\"return (\"+t.map(e=>{const n=e.abgrShift+(8-e.size);return`(${Ft(\"x\",n)} & ${Fe(e.maskA)})`}).join(\" | \")+\") >>> 0;\"),Br=(t,e)=>{const n=t.map(s=>{if(s.size!==8){const i=s.mask0,a=255/i,o=Ft(\"x\",s.shift);return Et(`((${o} & ${i}) * ${a})`,24-s.lane*8)}else return Et(`(x & ${Fe(s.maskA)})`,s.abgrShift)}).join(\" | \"),r=e?\"\":\"0xff000000 | \";return new Function(\"x\",`return (${r}${n}) >>> 0;`)},kr=(t,e,n)=>{const r=1<<t.size,s=r-1,i=s<<n>>>0,a=~i>>>0,o=t.lane!=null?t.lane:e,c=h=>h>>>n&s,l=(h,u)=>h&a|(u&s)<<n;return{size:t.size,num:r,abgrShift:24-o*8-n,lane:o,shift:n,mask0:s,maskA:i,int:c,setInt:l,float:h=>c(h)/s,setFloat:(h,u)=>l(h,m(u)*s)}},De=t=>{A(t.channels.length>0,\"no channel specs given\");const e=t.channels.reduce(([n,r],s,i)=>(r-=s.size,n.push(kr(s,i,r)),[n,r]),[[],t.size])[0];return{__packed:!0,type:t.type,size:t.size,alpha:t.alpha||0,channels:e,fromABGR:t.fromABGR||Sr(e),toABGR:t.toABGR||Br(e,!!t.alpha)}},Dt=De({type:\"u32\",size:32,alpha:8,channels:[{size:8,lane:w.ALPHA},{size:8,lane:w.BLUE},{size:8,lane:w.GREEN},{size:8,lane:w.RED}],fromABGR:ft,toABGR:ft}),Ne=Math.PI,k=Ne*2,Gr=1/k;let I=1e-6;const Te=(t,e,n,r,s,i)=>{const a=1-s,o=1-i;return t*a*o+e*s*o+n*a*i+r*s*i},J=(t,e,n,r,s)=>{r*=.5;const i=-.5*t+1.5*e-1.5*n+r,a=t-2.5*e+2*n-r,o=-.5*t+.5*n,c=e,l=s*s;return s*l*i+l*a+s*o+c},qe=(t,e,n,r,s,i,a,o,c,l,h,u,f,d,g,b,y,p)=>J(J(t,e,n,r,y),J(s,i,a,o,y),J(c,l,h,u,y),J(f,d,g,b,y),p),bt=(t,e)=>t-e*Math.floor(t/e),_=t=>t-Math.floor(t),Pe=(t,e=1)=>Math.round(t/e)*e;function je(t,e=\"linear\",n=\"clamp\"){const r=!!t.format.__float,s=t.format.channels.length===1?\"1\":\"\",i=`${e[0]}${n[0]}${s}`,a=(r?{nc1:yt,nw1:At,nr1:_t,nc:yt,nw:At,nr:_t,lc1:o=>Nt(E(o)),lw1:o=>Nt(F(o)),lr1:o=>Nt(D(o)),lc:o=>qt(o,yt(o)),lw:o=>qt(o,At(o)),lr:o=>qt(o,_t(o)),cc1:o=>jt(E(o)),cw1:o=>jt(F(o)),cr1:o=>jt(D(o)),cc:o=>Ht(o,yt(o)),cw:o=>Ht(o,At(o)),cr:o=>Ht(o,_t(o))}:{nc1:E,nw1:F,nr1:D,nc:E,nw:F,nr:D,lc1:o=>pt(E(o)),lw1:o=>pt(F(o)),lr1:o=>pt(D(o)),lc:o=>Tt(o,E(o)),lw:o=>Tt(o,F(o)),lr:o=>Tt(o,D(o)),cc1:o=>Pt(o,E(o)),cw1:o=>Pt(o,F(o)),cr1:o=>Pt(o,D(o)),cc:o=>Lt(o,E(o)),cw:o=>Lt(o,F(o)),cr:o=>Lt(o,D(o))})[i];return A(!!a,`missing impl for ${i}`),a(t)}const E=({data:t,width:e,height:n})=>(r,s)=>r>=0&&r<e&&s>=0&&s<n?t[(s|0)*e+(r|0)]:0,F=({data:t,width:e,height:n})=>(r,s)=>t[bt(s|0,n)*e+bt(r|0,e)],D=({data:t,width:e,height:n})=>{const r=e-1,s=n-1;return(i,a)=>t[B(a|0,0,s)*e+B(i|0,0,r)]},yt=({data:t,width:e,height:n,stride:[r,s]})=>(i,a)=>{let o;return i>=0&&i<e&&a>=0&&a<n?(o=(a|0)*s+(i|0)*r,t.slice(o,o+r)):[0]},At=({data:t,width:e,height:n,stride:[r,s]})=>(i,a)=>{let o=bt(a|0,n)*s+bt(i|0,e)*r;return t.slice(o,o+r)},_t=({data:t,width:e,height:n,stride:[r,s]})=>{const i=e-1,a=n-1;return(o,c)=>{let l=B(c|0,0,a)*s+B(o|0,0,i)*r;return t.slice(l,l+r)}},Q=(t,e,n,r,s=4)=>Te(t[r],t[r+s],t[r+2*s],t[r+3*s],e,n),pt=t=>(e,n)=>(e-=.5,n-=.5,Te(t(e,n),t(e+1,n),t(e,n+1),t(e+1,n+1),_(e),_(n))),Nt=t=>(t=pt(t),(e,n)=>[t(e,n)]),Tt=(t,e)=>{const{fromABGR:n,toABGR:r}=t.format,s=new Uint32Array(4),i=new Uint8Array(s.buffer);return(a,o)=>{a-=.5,o-=.5,s[0]=r(e(a,o)),s[1]=r(e(a+1,o)),s[2]=r(e(a,o+1)),s[3]=r(e(a+1,o+1));const c=_(a),l=_(o);return n(Q(i,c,l,0)|Q(i,c,l,1)<<8|Q(i,c,l,2)<<16|Q(i,c,l,3)<<24)>>>0}},qt=({stride:[t]},e)=>{const n=new Float32Array(t*4);return(r,s)=>{r-=.5,s-=.5,n.set(e(r,s),0),n.set(e(r+1,s),t),n.set(e(r,s+1),t*2),n.set(e(r+1,s+1),t*3);const i=_(r),a=_(s);let o=[];for(let c=0;c<t;c++)o.push(Q(n,i,a,c,t));return o}},Le=t=>(e,n)=>{e-=.5,n-=.5;const r=e-1,s=e+1,i=e+2,a=n-1,o=n+1,c=n+2;return qe(t(r,a),t(e,a),t(s,a),t(i,a),t(r,n),t(e,n),t(s,n),t(i,n),t(r,o),t(e,o),t(s,o),t(i,o),t(r,c),t(e,c),t(s,c),t(i,c),_(e),_(n))},Pt=(t,e)=>{const n=t.format.channels[0].mask0;return e=Le(e),(r,s)=>B(e(r,s),0,n)},jt=t=>(t=Le(t),(e,n)=>[t(e,n)]),He=(t,e,n,r,s=4)=>qe(t[r],t[r+s],t[r+2*s],t[r+3*s],t[r+4*s],t[r+5*s],t[r+6*s],t[r+7*s],t[r+8*s],t[r+9*s],t[r+10*s],t[r+11*s],t[r+12*s],t[r+13*s],t[r+14*s],t[r+15*s],e,n),wt=(t,e,n,r,s=4)=>B(He(t,e,n,r,s),0,255),Lt=(t,e)=>{const{fromABGR:n,toABGR:r}=t.format,s=new Uint32Array(16),i=new Uint8Array(s.buffer);return(a,o)=>{a-=.5,o-=.5;const c=a-1,l=a+1,h=a+2,u=o-1,f=o+1,d=o+2,g=_(a),b=_(o);return s[0]=r(e(c,u)),s[1]=r(e(a,u)),s[2]=r(e(l,u)),s[3]=r(e(h,u)),s[4]=r(e(c,o)),s[5]=r(e(a,o)),s[6]=r(e(l,o)),s[7]=r(e(h,o)),s[8]=r(e(c,f)),s[9]=r(e(a,f)),s[10]=r(e(l,f)),s[11]=r(e(h,f)),s[12]=r(e(c,d)),s[13]=r(e(a,d)),s[14]=r(e(l,d)),s[15]=r(e(h,d)),n(wt(i,g,b,0)|wt(i,g,b,1)<<8|wt(i,g,b,2)<<16|wt(i,g,b,3)<<24)>>>0}},Ht=({stride:[t]},e)=>{const n=new Float32Array(t*16);return(r,s)=>{r-=.5,s-=.5;const i=r-1,a=r+1,o=r+2,c=s-1,l=s+1,h=s+2,u=_(r),f=_(s);n.set(e(i,c),0),n.set(e(r,c),t),n.set(e(a,c),2*t),n.set(e(o,c),3*t),n.set(e(i,s),4*t),n.set(e(r,s),5*t),n.set(e(a,s),6*t),n.set(e(o,s),7*t),n.set(e(i,l),8*t),n.set(e(r,l),9*t),n.set(e(a,l),10*t),n.set(e(o,l),11*t),n.set(e(i,h),12*t),n.set(e(r,h),13*t),n.set(e(a,h),14*t),n.set(e(o,h),15*t);let d=[];for(let g=0;g<t;g++)d.push(He(n,u,f,g,t));return d}};var Mr=Object.getOwnPropertyDescriptor,Ur=(t,e,n,r)=>{for(var s=r>1?void 0:r?Mr(e,n):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(s=a(s)||s);return s};function Ir(...t){return t[0]instanceof x?t[0].as(t[1]):new x(...t)}const xr=(t,e=Dt)=>{const{data:n}=Zn(t),r=t.width,s=t.height;let i;if(e===Dt)i=n;else{i=mt(e.type,r*s);const a=n,o=e.fromABGR;for(let c=i.length;c-- >0;)i[c]=o(a[c])}return new x(r,s,e,i)};let x=class{size;stride;format;data;constructor(t,e,n=Dt,r){this.size=[t,e],this.stride=[1,t],this.format=n.__packed?n:De(n),this.data=r||mt(n.type,t*e)}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}*[Symbol.iterator](){yield*this.data}as(t){if(!t.__float)return this.getRegion(0,0,this.width,this.height,t);const e=new v(this.width,this.height,t),{data:n,format:r,stride:[s]}=e,{data:i,format:a}=this;for(let o=i.length;o-- >0;)n.set(r.fromABGR(a.toABGR(i[o])),o*s);return e}copy(){const t=this.empty();return t.data.set(this.data),t}empty(){return new x(this.width,this.height,this.format)}order(){}includes(t,e){}indexAt(t,e){}indexAtUnsafe(t,e){}getAt(t,e){}getAtUnsafe(t,e){}setAt(t,e,n){}setAtUnsafe(t,e,n){}getChannelAt(t,e,n,r=!1){const s=O(this.format,n),i=this.getAt(t,e);return r?s.float(i):s.int(i)}setChannelAt(t,e,n,r,s=!1){const i=O(this.format,n),a=this.getAt(t,e);return s?i.setFloat(a,r):i.setInt(a,r),this}blend(t,e,n){let r=this.width,s=e.width;const{sx:i,sy:a,dx:o,dy:c,rw:l,rh:h}=dt(this,e,n);if(l<1||h<1)return e;const u=this.data,f=e.data,d=this.format.toABGR,g=e.format.toABGR,b=e.format.fromABGR;for(let y=(i|0)+(a|0)*r,p=(o|0)+(c|0)*s,N=0;N<h;N++,y+=r,p+=s)for(let U=0;U<l;U++)f[p+U]=b(t(d(u[y+U]),g(f[p+U])));return e}blit(t,e){let n=this.width,r=t.width;const{sx:s,sy:i,dx:a,dy:o,rw:c,rh:l}=dt(this,t,e);if(c<1||l<1)return t;const h=this.data,u=t.data,f=this.format.toABGR,d=t.format.fromABGR,g=this.format!==t.format?(b,y)=>{for(let p=0;p<c;p++)u[y+p]=d(f(h[b+p]))}:(b,y)=>u.set(h.subarray(b,b+c),y);for(let b=(s|0)+(i|0)*n,y=(a|0)+(o|0)*r,p=0;p<l;p++,b+=n,y+=r)g(b,y);return t}blitCanvas(t,e={}){Oe(this,t,e)}setImageData(t){zt(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,r=this.format.fromABGR;for(let s=e.length;s-- >0;)n[s]=r(e[s]);return this}toImageData(t){t=xe(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),n=this.data,r=this.format.toABGR;for(let s=e.length;s-- >0;)e[s]=r(n[s]);return t}getRegion(t,e,n,r,s){const[i,a,o,c]=ut(t,e,n,r,this.width,this.height);if(!(o<1||c<1))return this.blit(new x(o,c,s||this.format),{sx:i,sy:a,w:o,h:c})}getChannel(t){const e=O(this.format,t),n=new x(this.width,this.height,{type:$r(e.size),size:e.size,channels:[{size:e.size,lane:w.RED}],fromABGR:Cr(e.size),toABGR:vr(e.size)}),r=this.data,s=n.data,i=e.int;for(let a=r.length;a-- >0;)s[a]=i(r[a]);return n}setChannel(t,e){const n=O(this.format,t),r=this.data,s=n.setInt;if(q(e))ar(r,e,s);else{const i=e.data,a=e.format.channels[0];Ie(i,this.width,this.height),n.size===a.size?cr(r,i,a.int,s):lr(r,i,this.format.fromABGR,e.format.toABGR,n.maskA)}return this}invert(){const{data:t,format:e}=this,n=Math.pow(2,e.size-e.alpha)-1;for(let r=t.length;r-- >0;)t[r]^=n;return this}premultiply(){return ir(this.format),ze(this.data,this.format,er),this}postmultiply(){return ze(this.data,this.format,rr),this}isPremultiplied(){const t=this.data,e=this.format.toABGR;for(let n=t.length;n-- >0;)if(!or(e(t[n])))return!1;return!0}forEach(t){const e=this.data;for(let n=e.length;n-- >0;)e[n]=t(e[n],n);return this}fill(t){this.data.fill(t)}flipX(){const{data:t,width:e}=this;for(let n=0;n<t.length;n+=e)t.subarray(n,n+e).reverse();return this}flipY(){const{data:t,width:e}=this,n=mt(this.format.type,e);for(let r=0,s=t.length-e;r<s;r+=e,s-=e)n.set(t.subarray(r,r+e)),t.copyWithin(r,s,s+e),t.set(n,s);return this}rotateByID(t){return t>0?this[Be[t-1]]():this}rotateCW(){const{width:t,height:e}=this,n=e-1;return this._rotate((r,s)=>r*e+n-s),this.size[0]=e,this.size[1]=t,this}rotateCCW(){const{width:t,height:e}=this,n=t-1;return this._rotate((r,s)=>(n-r)*e+s),this.size[0]=e,this.size[1]=t,this}rotate180(){const{width:t,height:e}=this,n=t-1,r=e-1;return this._rotate((s,i)=>(r-i)*t+n-s),this}scale(t,e=\"linear\"){return A(t>0,\"scale must be > 0\"),this.resize(this.width*t,this.height*t,e)}resize(t,e,n=\"linear\"){t|=0,e|=0,A(t>0&&e>0,\"target width & height must be > 0\");const r=Ir(t,e,this.format),s=r.data,i=t>0?this.width/t:0,a=e>0?this.height/e:0;n=P(n)?je(this,n,\"repeat\"):n;for(let o=0,c=0;o<e;o++){const l=o*a;for(let h=0;h<t;h++,c++)s[c]=n(h*i,l)}return r}upsize(){const{width:t,height:e,data:n}=this,r=new x(t*2,e*2,this.format),s=r.data;for(let i=0,a=0;i<e;i++)for(let o=0,c=i*t*4;o<t;o++,a++,c+=2)s[c]=n[a];return r}_rotate(t){const{data:e,format:n,width:r,height:s}=this,i=mt(n.type,r*s);for(let a=0;a<s;a++)for(let o=0;o<r;o++)i[t(o,a)]=e[a*r+o];this.data=i}};x=Ur([ke],x);var zr=Object.defineProperty,Or=Object.getOwnPropertyDescriptor,tt=(t,e,n,r)=>{for(var s=r>1?void 0:r?Or(e,n):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(s=(r?a(e,n,s):a(s))||s);return r&&s&&zr(e,n,s),s};function We(...t){return t[0]instanceof x?Er(...t):new v(...t)}const Er=(t,e)=>{const n=new v(t.width,t.height,e),{data:r,format:s,stride:[i]}=n,{data:a,format:o}=t;for(let c=a.length;c-- >0;)r.set(s.fromABGR(o.toABGR(a[c])),c*i);return n},Fr=(t,e=j)=>xr(t).as(e);let v=class{size;stride;format;data;__empty;constructor(t,e,n=j,r){this.size=[t,e],this.format=n.__float?n:gt(n);const s=this.format.channels.length;this.stride=[s,t*s],this.data=r||new Float32Array(t*e*s),this.__empty=Object.freeze(new Array(s).fill(0))}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}*[Symbol.iterator](){const{data:t,stride:[e]}=this;for(let n=0,r=t.length;n<r;n+=e)yield t.subarray(n,n+e)}as(t){const{width:e,height:n,stride:[r],data:s,format:{size:i,normalized:a,toABGR:o}}=this;let c=0,l=0,h=s.length;if(t.__float){const u=t,f=new v(e,n,u),{data:d,stride:[g]}=f;if(i===1&&u.channels.length===1){const b=u.fromNormalized;for(;c<h;c+=r,l+=g)d[l]=b(a(s[c]))}else for(;c<h;c+=r,l+=g)d.set(u.fromABGR(o(s.subarray(c,c+r))),l);return f}else{const u=t,f=new x(e,n,u),d=f.data;if(i===1&&u.channels.length===1){const g=u.channels[0].setFloat;for(;c<h;c+=r,l++)d[l]=g(0,a(s[c]))}else for(;c<h;c+=r,l++)d[l]=u.fromABGR(o(s.subarray(c,c+r)));return f}}copy(){const t=this.empty();return t.data.set(this.data),t}empty(){return new v(this.width,this.height,this.format)}order(){}includes(t,e){}indexAt(t,e){}indexAtUnsafe(t,e){}getAt(t,e){return this.includes(t,e)?this.getAtUnsafe(t,e):this.__empty}getAtUnsafe(t,e){const n=this.indexAtUnsafe(t,e);return this.data.subarray(n,n+this.stride[0])}setAt(t,e,n){return this.includes(t,e)?(this.data.set(n,this.indexAtUnsafe(t,e)),!0):!1}setAtUnsafe(t,e,n){return this.data.set(n,this.indexAtUnsafe(t,e)),!0}getChannelAt(t,e,n){return O(this.format,n),this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)+n]:void 0}setChannelAt(t,e,n,r){return O(this.format,n),this.includes(t,e)&&(this.data[this.indexAtUnsafe(t,e)+n]=r),this}getChannel(t){O(this.format,t);const{data:e,stride:[n]}=this,[r,s]=this.format.range,i=new Float32Array(this.width*this.height);for(let a=t,o=0,c=e.length;a<c;a+=n,o++)i[o]=B(e[a],r,s);return new v(this.width,this.height,Ee,i)}setChannel(t,e){O(this.format,t);const{data:n,stride:[r]}=this;if(q(e))for(let s=t,i=n.length;s<i;s+=r)n[s]=e;else{const{data:s,stride:[i]}=e;Ie(s,this.width,this.height,i);for(let a=t,o=0,c=n.length;a<c;a+=r,o+=i)n[a]=s[o]}return this}blend(t,e,n){this.ensureFormat(e);const{sx:r,sy:s,dx:i,dy:a,rw:o,rh:c}=dt(this,e,n);if(o<1||c<1)return e;const l=this.data,h=e.data,[u,f]=this.stride,d=e.stride[1];for(let g=(r|0)*u+(s|0)*f,b=(i|0)*u+(a|0)*d,y=0;y<c;y++,g+=f,b+=d)for(let p=o,N=g,U=b;p-- >0;N+=u,U+=u){const it=h.subarray(U,U+u);t(it,l.subarray(N,N+u),it)}return e}blit(t,e){this.ensureFormat(t);const{sx:n,sy:r,dx:s,dy:i,rw:a,rh:o}=dt(this,t,e);if(a<1||o<1)return t;const c=this.data,l=t.data,[h,u]=this.stride,f=t.stride[1],d=a*h;for(let g=(n|0)*h+(r|0)*u,b=(s|0)*h+(i|0)*f,y=0;y<o;y++,g+=u,b+=f)l.set(c.subarray(g,g+d),b);return t}blitCanvas(t,e={}){Oe(this,t,e)}setImageData(t){zt(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),{data:n,format:{fromABGR:r},stride:[s]}=this,i=[];for(let a=e.length;a-- >0;)n.set(r(e[a],i),a*s);return this}toImageData(t){t=xe(t,this.width,this.height);const e=new Uint32Array(t.data.buffer),{stride:[n],data:r,format:s}=this;for(let i=0,a=0,o=r.length;i<o;i+=n,a++)e[a]=s.toABGR(r.subarray(i,i+n));return t}getRegion(t,e,n,r){const[s,i,a,o]=ut(t,e,n,r,this.width,this.height);if(!(a<1||o<1))return this.blit(new v(a,o,this.format),{sx:s,sy:i,w:a,h:o})}forEach(t){const{data:e,stride:[n]}=this;for(let r=0,s=0,i=e.length;r<i;r+=n,s++)e.set(t(e.subarray(r,r+n),s),r);return this}fill(t){A(t.length<=this.format.channels.length,\"fill value has too many channels\");const{data:e,stride:[n]}=this;for(let r=0,s=e.length;r<s;r+=n)e.set(t,r)}premultiply(){this.ensureRGBA();const{data:t,stride:[e]}=this;for(let n=0,r=t.length;n<r;n+=e)tr(null,t.subarray(n,n+e));return this}postmultiply(){this.ensureRGBA();const{data:t,stride:[e]}=this;for(let n=0,r=t.length;n<r;n+=e)nr(null,t.subarray(n,n+e));return this}isPremultiplied(){this.ensureRGBA();const{data:t,stride:[e]}=this;for(let n=0,r=t.length;n<r;n+=e)if(!sr(t.subarray(n,n+e)))return!1;return!0}clamp(){const t=this.data,[e,n]=this.format.range;for(let r=t.length;r-- >0;)t[r]=B(t[r],e,n);return this}clampChannel(t){O(this.format,t);const{data:e,stride:[n]}=this,[r,s]=this.format.range;for(let i=t,a=e.length;i<a;i+=n)e[i]=B(e[i],r,s)}flipX(){const{data:t,width:e,height:n,stride:[r,s]}=this,i=new Float32Array(r),a=e-1,o=e>>>1;for(let c=0;c<n;c++)for(let l=0,h=c*s,u=h+a*r;l<o;l++,h+=r,u-=r)i.set(t.subarray(h,h+r)),t.copyWithin(h,u,u+r),t.set(i,u);return this}flipY(){const t=this.data,e=this.stride[1],n=new Float32Array(e);for(let r=0,s=t.length-e;r<s;r+=e,s-=e)n.set(t.subarray(r,r+e)),t.copyWithin(r,s,s+e),t.set(n,s);return this}rotateByID(t){return t>0?this[Be[t-1]]():this}rotateCW(){const{width:t,height:e}=this,n=e-1;return this._rotate((r,s)=>r*e+n-s),this.size[0]=e,this.size[1]=t,this}rotateCCW(){const{width:t,height:e}=this,n=t-1;return this._rotate((r,s)=>(n-r)*e+s),this.size[0]=e,this.size[1]=t,this}rotate180(){const{width:t,height:e}=this,n=t-1,r=e-1;return this._rotate((s,i)=>(r-i)*t+n-s),this}invert(){const{data:t,format:e,stride:[n]}=this;for(let r=0,s=t.length,i=e.alpha?n-1:n;r<s;r+=n)for(let a=0;a<i;a++)t[r+a]=1-t[r+a];return this}scale(t,e){return A(t>0,\"scale must be > 0\"),this.resize(this.width*t,this.height*t,e)}resize(t,e,n=\"linear\"){t|=0,e|=0,A(t>0&&e>0,\"target width & height must be > 0\");const r=We(t,e,this.format),s=r.data,i=t>0?this.width/t:0,a=e>0?this.height/e:0,o=this.stride[0];n=P(n)?je(this,n,\"repeat\"):n;for(let c=0,l=0;c<e;c++){const h=c*a;for(let u=0;u<t;u++,l+=o)s.set(n(u*i,h),l)}return r}upsize(){const{width:t,height:e,data:n,stride:[r,s]}=this,i=r*2,a=We(t*2,e*2,this.format),o=a.data;for(let c=0,l=0;c<e;c++)for(let h=0,u=c*s*4;h<t;h++,l+=r,u+=i)o.set(n.subarray(l,l+r),u);return a}_rotate(t){const{data:e,width:n,height:r,stride:[s]}=this,i=new Float32Array(n*r*s);for(let a=0,o=0;a<r;a++)for(let c=0;c<n;c++,o+=s)i.set(e.subarray(o,o+s),t(c,a)*s);this.data=i}ensureFormat(t){A(t.format===this.format,\"dest buffer format must be same as src\")}ensureRGBA(){A(this.format===j,\"require FLOAT_RGBA format\")}};tt([ct],v.prototype,\"getAt\",1),tt([ct],v.prototype,\"getAtUnsafe\",1),tt([ct],v.prototype,\"setAt\",1),tt([ct],v.prototype,\"setAtUnsafe\",1),v=tt([ke],v);const Dr=(t,e,n)=>(t-e)/(n-e),Nr=(t,e,n,r,s)=>r+(s-r)*Dr(t,e,n),Rt=Math.abs,Tr=Math.min,qr=gt({alpha:!0,channels:[w.RED,w.GREEN,w.BLUE,w.ALPHA],convert:{fromABGR:(t,e=[])=>{const n=(t>>>24&255)/255,r=(t>>>16&255)/255,s=(t>>>8&255)/255,i=(t&255)/255;let a,o,c,l,h,u,f,d;s<r?(a=r,o=s,c=-1,l=2/3):(a=s,o=r,c=0,l=-1/3),i<a?(h=a,u=o,f=l,d=i):(h=i,u=o,f=c,d=a);const g=h-Tr(u,d);return h=m(h),e[0]=m(Rt((d-u)/(6*g+I)+f)),e[1]=m(g/(h+I)),e[2]=h,e[3]=n,e},toABGR:t=>{const e=t[0]*6,n=t[1],r=t[2]*255,s=t[3]*255,i=((m(Rt(e-3)-1)-1)*n+1)*r,a=((m(2-Rt(e-2))-1)*n+1)*r,o=((m(2-Rt(e-4))-1)*n+1)*r;return(s<<24|o<<16|a<<8|i)>>>0}}}),j=gt({alpha:!0,channels:[w.RED,w.GREEN,w.BLUE,w.ALPHA]}),Pr=ht(()=>\"unsupported operation\"),Wt=t=>{throw new Pr(t)},G=(t=1,e,...n)=>{const r=[,,].concat(n),s=(...i)=>{const a=r[i[t].length]||e;return a?a(...i):Wt(`no impl for vec size ${i[t].length}`)};return s.add=(i,a)=>r[i]=a,s.default=i=>e=i,s.impl=i=>i!=null&&r[i]||e,s},jr=(t,e)=>t[0]*e[0]+t[1]*e[1],Yt=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],Lr=G(0,(t,e)=>{let n=0;for(let r=t.length;r-- >0;)n+=t[r]*e[r];return n},jr,Yt,(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]);function Ye(t,e=Object.create(null)){return(...n)=>{const r=JSON.stringify(n);return r!==void 0?r in e?e[r]:e[r]=t.apply(null,n):t.apply(null,n)}}function Ve(t,e=Object.create(null)){return(...n)=>{const r=n.join(\"-\");return r in e?e[r]:e[r]=t(...n)}}const Hr=Ve((t,e)=>t.repeat(e)),Xe=Ye((t,e=!1)=>e?n=>Wr(n)||n.toFixed(t):n=>n.toFixed(t)),Wr=t=>isNaN(t)?\"NaN\":t===1/0?\"+∞\":t===-1/0?\"-∞\":void 0,Yr=(t=0)=>e=>(e*100).toFixed(t)+\"%\",Vr=[.299,.587,.114],Ke=[.2126,.7152,.0722],Xr=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],Kr=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],Zr=[.96422,1,.82521],Jr=[.95047,1,1.08883],Qr=[.2104542553,1.9779984951,.0259040371,.793617785,-2.428592205,.7827717662,-.0040720468,.4505937099,-.808675766];let $t=Xe(3),Ze=Yr(3);const M=1/255,Vt=(t,e=Ke)=>Yt(t,e),ts=t=>Yt(t,Vr),es=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t),ns=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t),L=(t,e)=>(!t&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t),rs=G(1,(t,e)=>{!t&&(t=[]);for(let n=e.length;n-- >0;)t[n]=e[n];return t},es,ns,L),et=(t,e)=>typeof t?.[e]==\"function\",Xt=t=>t!=null&&typeof t!=\"function\"&&t.length!==void 0,ss=ht(()=>\"illegal argument(s)\"),Kt=t=>{throw new ss(t)},os=Ye((t,e=3,n=\",\",r=\"[\",s=\"]\")=>{const i=typeof e==\"number\"?Xe(e):e;switch(t){case 1:return a=>`${r}${i(a[0])}${s}`;case 2:return a=>`${r}${i(a[0])}${n}${i(a[1])}${s}`;case 3:return a=>`${r}${i(a[0])}${n}${i(a[1])}${n}${i(a[2])}${s}`;case 4:return a=>`${r}${i(a[0])}${n}${i(a[1])}${n}${i(a[2])}${n}${i(a[3])}${s}`;default:return a=>{const o=[];for(let c=0;c<a.length;c++)o.push(i(a[c]));return`${r}${o.join(n)}${s}`}}}),is=(t,e,n,r,s,i)=>{const a=[];for(;n-- >0;)a.push(new t(e,r,s)),r+=i;return a},as=(t,e=1,n=!0)=>{const r=n?(o,c,l,h)=>{!o&&(o=c);for(let u=c.length;u-- >0;)o[u]=t(c[u],l[u],h[u]);return o}:(o,c,l,h)=>{!o&&(o=h);for(let u=c.length;u-- >0;)o[u]=t(c[u],l[u],h[u]);return o},s=n?(o,c,l,h)=>(!o&&(o=c),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o):(o,c,l,h)=>(!o&&(o=h),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o),i=n?(o,c,l,h)=>(!o&&(o=c),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o[2]=t(c[2],l[2],h[2]),o):(o,c,l,h)=>(!o&&(o=h),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o[2]=t(c[2],l[2],h[2]),o),a=n?(o,c,l,h)=>(!o&&(o=c),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o[2]=t(c[2],l[2],h[2]),o[3]=t(c[3],l[3],h[3]),o):(o,c,l,h)=>(!o&&(o=h),o[0]=t(c[0],l[0],h[0]),o[1]=t(c[1],l[1],h[1]),o[2]=t(c[2],l[2],h[2]),o[3]=t(c[3],l[3],h[3]),o);return[G(e,r,s,i,a),s,i,a]},[Ai,_i,pi,cs]=as(B),ls=cs,hs=(t,e,n,r=!0,s=!0)=>{const i=n>0?r?function(){return this.buf[this.offset+n*this.stride]}:function(){return this.buf[this.offset+n]}:function(){return this.buf[this.offset]},a=n>0?r?function(o){this.buf[this.offset+n*this.stride]=o}:function(o){this.buf[this.offset+n]=o}:function(o){this.buf[this.offset]=o};s&&Object.defineProperty(t,n,{get:i,set:a,enumerable:!0}),Object.defineProperty(t,e,{get:i,set:a,enumerable:!0})},fs=(t,e,n,r)=>e.forEach((s,i)=>hs(t,s,i,n,r)),us=Math.abs,z=(t,e,n=I)=>us(t-e)<=n,ds=(t,e,n=I)=>t.length===e.length&&z(t[0],e[0],n)&&z(t[1],e[1],n),gs=(t,e,n=I)=>t.length===e.length&&z(t[0],e[0],n)&&z(t[1],e[1],n)&&z(t[2],e[2],n),Je=(t,e,n=I)=>t.length===e.length&&z(t[0],e[0],n)&&z(t[1],e[1],n)&&z(t[2],e[2],n)&&z(t[3],e[3],n);G(0,(t,e,n=I)=>et(t,\"eqDelta\")?t.eqDelta(e,n):et(e,\"eqDelta\")?e.eqDelta(t,n):ms(t,e,t.length,n),ds,gs,Je);const ms=(t,e,n,r=I,s=0,i=0,a=1,o=1)=>{for(;n>0;n--,s+=a,i+=o)if(!z(t[s],e[i],r))return!1;return!0};function*bs(t,e,n,r){for(;e-- >0;)yield t[n],n+=r}const Qe=1/2**32;class ys{float(e=1){return this.int()*Qe*e}probability(e){return this.float()<e}norm(e=1){return(this.int()*Qe-.5)*2*e}normMinMax(e,n){const r=this.minmax(e,n);return this.float()<.5?r:-r}minmax(e,n){return this.float()*(n-e)+e}minmaxInt(e,n){e|=0;const r=(n|0)-e;return r?e+this.int()%r:e}minmaxUint(e,n){e>>>=0;const r=(n>>>0)-e;return r?e+this.int()%r:e}}class As extends ys{constructor(e){super(),this.rnd=e}float(e=1){return this.rnd()*e}norm(e=1){return(this.rnd()-.5)*2*e}int(){return this.rnd()*4294967296>>>0}}const Zt=new As(Math.random),_s=(t,e,n=Zt)=>{const r=t.length;A(r>0,\"no choices given\");const s=e?t.map((a,o)=>[e[o]||0,a]).sort((a,o)=>o[0]-a[0]):t.map(a=>[1,a]),i=s.reduce((a,o)=>a+o[0],0);return i<=0&&console.warn(\"total weights <= 0\"),()=>{const a=n.float(i);let o=i;for(let c=0;c<r;c++)if(o-=s[c][0],o<=a)return s[c][1]}},ps=G(1,(t,e,n,r=Zt)=>{!t&&(t=e);for(let s=e.length;s-- >0;)t[s]=r.minmax(e[s],n[s]);return t}),tn=Array.isArray,nt={},en=(t,e)=>{for(let n in e){const r=e[n];if(tn(r)){const[s,i,a,o]=r;e[n]=r.length===2?(c,l)=>i(c,s(c,l)):r.length===3?(c,l)=>a(c,i(c,s(c,l))):(c,l)=>o(c,a(c,i(c,s(c,l))))}}nt[t]={...nt[t],...e}},nn=(t,e,n,r)=>{const s=nt[n];A(!!s,`no conversions available for ${n}`);let i=s[r];return i?i(t,e):nt.rgb[r]?s.rgb(t,nt.rgb[r]([],e)):Wt(`can't convert: ${r} -> ${n}`)},rn=(t,e)=>(t>>>e|t<<32-e)>>>0,ws=t=>(t&3840)*4352|(t&240)*272|(t&15)*17,Rs=t=>((t&61440)*69632|(t&3840)*4352|(t&240)*272|(t&15)*17)>>>0;class T{constructor(e,n){this.mode=e,this.value=n}deref(){return this.value}}const $s={aliceblue:\"f0f8ff\",antiquewhite:\"faebd7\",aqua:\"0ff\",aquamarine:\"7fffd4\",azure:\"f0ffff\",beige:\"f5f5dc\",bisque:\"ffe4c4\",black:\"000\",blanchedalmond:\"ffebcd\",blue:\"00f\",blueviolet:\"8a2be2\",brown:\"a52a2a\",burlywood:\"deb887\",cadetblue:\"5f9ea0\",chartreuse:\"7fff00\",chocolate:\"d2691e\",coral:\"ff7f50\",cornflowerblue:\"6495ed\",cornsilk:\"fff8dc\",crimson:\"dc143c\",cyan:\"0ff\",darkblue:\"00008b\",darkcyan:\"008b8b\",darkgoldenrod:\"b8860b\",darkgray:\"a9a9a9\",darkgreen:\"006400\",darkgrey:\"a9a9a9\",darkkhaki:\"bdb76b\",darkmagenta:\"8b008b\",darkolivegreen:\"556b2f\",darkorange:\"ff8c00\",darkorchid:\"9932cc\",darkred:\"8b0000\",darksalmon:\"e9967a\",darkseagreen:\"8fbc8f\",darkslateblue:\"483d8b\",darkslategray:\"2f4f4f\",darkslategrey:\"2f4f4f\",darkturquoise:\"00ced1\",darkviolet:\"9400d3\",deeppink:\"ff1493\",deepskyblue:\"00bfff\",dimgray:\"696969\",dimgrey:\"696969\",dodgerblue:\"1e90ff\",firebrick:\"b22222\",floralwhite:\"fffaf0\",forestgreen:\"228b22\",fuchsia:\"f0f\",gainsboro:\"dcdcdc\",ghostwhite:\"f8f8ff\",gold:\"ffd700\",goldenrod:\"daa520\",gray:\"808080\",grey:\"808080\",green:\"008000\",greenyellow:\"adff2f\",honeydew:\"f0fff0\",hotpink:\"ff69b4\",indianred:\"cd5c5c\",indigo:\"4b0082\",ivory:\"fffff0\",khaki:\"f0e68c\",lavender:\"e6e6fa\",lavenderblush:\"fff0f5\",lawngreen:\"7cfc00\",lemonchiffon:\"fffacd\",lightblue:\"add8e6\",lightcoral:\"f08080\",lightcyan:\"e0ffff\",lightgoldenrodyellow:\"fafad2\",lightgray:\"d3d3d3\",lightgreen:\"90ee90\",lightgrey:\"d3d3d3\",lightpink:\"ffb6c1\",lightsalmon:\"ffa07a\",lightseagreen:\"20b2aa\",lightskyblue:\"87cefa\",lightslategray:\"789\",lightslategrey:\"789\",lightsteelblue:\"b0c4de\",lightyellow:\"ffffe0\",lime:\"0f0\",limegreen:\"32cd32\",linen:\"faf0e6\",magenta:\"f0f\",maroon:\"800000\",mediumaquamarine:\"66cdaa\",mediumblue:\"0000cd\",mediumorchid:\"ba55d3\",mediumpurple:\"9370db\",mediumseagreen:\"3cb371\",mediumslateblue:\"7b68ee\",mediumspringgreen:\"00fa9a\",mediumturquoise:\"48d1cc\",mediumvioletred:\"c71585\",midnightblue:\"191970\",mintcream:\"f5fffa\",mistyrose:\"ffe4e1\",moccasin:\"ffe4b5\",navajowhite:\"ffdead\",navy:\"000080\",oldlace:\"fdf5e6\",olive:\"808000\",olivedrab:\"6b8e23\",orange:\"ffa500\",orangered:\"ff4500\",orchid:\"da70d6\",palegoldenrod:\"eee8aa\",palegreen:\"98fb98\",paleturquoise:\"afeeee\",palevioletred:\"db7093\",papayawhip:\"ffefd5\",peachpuff:\"ffdab9\",peru:\"cd853f\",pink:\"ffc0cb\",plum:\"dda0dd\",powderblue:\"b0e0e6\",purple:\"800080\",red:\"f00\",rosybrown:\"bc8f8f\",royalblue:\"4169e1\",saddlebrown:\"8b4513\",salmon:\"fa8072\",sandybrown:\"f4a460\",seagreen:\"2e8b57\",seashell:\"fff5ee\",sienna:\"a0522d\",silver:\"c0c0c0\",skyblue:\"87ceeb\",slateblue:\"6a5acd\",slategray:\"708090\",slategrey:\"708090\",snow:\"fffafa\",springgreen:\"00ff7f\",steelblue:\"4682b4\",tan:\"d2b48c\",teal:\"008080\",thistle:\"d8bfd8\",tomato:\"ff6347\",turquoise:\"40e0d0\",violet:\"ee82ee\",wheat:\"f5deb3\",white:\"fff\",whitesmoke:\"f5f5f5\",yellow:\"ff0\",yellowgreen:\"9acd32\",transparent:\"0000\",rebeccapurple:\"639\"};let Cs={canvas:\"fff\",canvastext:\"000\",linktext:\"001ee4\",visitedtext:\"4e2386\",activetext:\"eb3323\",buttonface:\"ddd\",buttontext:\"000\",buttonborder:\"000\",field:\"fff\",fieldtext:\"000\",highlight:\"bbd5fb\",highlighttext:\"000\",mark:\"000\",marktext:\"fff\",graytext:\"808080\"};const S=(t,e,n,r)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=r,t),R=(t,e,n,r,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=r,t[3]=s,t),Ct=(t,e)=>R(t||[],(e>>>16&255)*M,(e>>>8&255)*M,(e&255)*M,(e>>>24)*M),sn=(t,e)=>R(t||[],(e&255)*M,(e>>>8&255)*M,(e>>>16&255)*M,(e>>>24)*M),vs=t=>{t=(P(t)?t:t.deref()).toLowerCase();const e=$s[t]||Cs[t];if(e||t[0]===\"#\")return new T(\"srgb\",Ct([],Bs(e||t)));const n=t.split(/[(),/ ]+/),[r,s,i,a,o]=n;switch(A(n.length===5||n.length===6,`invalid color: ${t}`),r){case\"rgb\":case\"rgba\":return new T(\"srgb\",[C(s,1,M,!0),C(i,1,M,!0),C(a,1,M,!0),H(o)]);case\"hsl\":case\"hsla\":return new T(\"hsl\",[Jt(s),on(i),on(a),H(o)]);case\"lab\":return new T(\"lab50\",[C(s),C(i,1.25),C(a,1.25),H(o)]);case\"lch\":return new T(r,[C(s),C(i,1.5),Jt(a),H(o)]);case\"oklab\":return new T(r,[C(s,1,1),C(i,.4,1),C(a,.4,1),H(o)]);case\"oklch\":return new T(r,[C(s,1,1),C(i,.4,1),Jt(a),H(o)]);default:Wt(`color mode: ${r}`)}},Ss={rad:k,grad:400,turn:1,deg:360},Jt=t=>{const e=/^(-?[0-9.]+)(deg|rad|grad|turn)?$/.exec(t);return A(!!e,`expected hue, got: ${t}`),_(parseFloat(e[1])/(Ss[e[2]]||360))},H=t=>t?C(t,1,1,!0):1,on=(t,e=!0)=>{A(/^([0-9.]+)%$/.test(t),`expected percentage, got: ${t}`);const n=parseFloat(t)/100;return e?m(n):n},C=(t,e=1,n=.01,r=!1)=>{A(/^-?[0-9.]+%?$/.test(t),`expected number or percentage, got: ${t}`);const s=parseFloat(t)*(t.endsWith(\"%\")?.01*e:n);return r?m(s):s},Bs=t=>{const e=/^#?([0-9a-f]{3,8})$/i.exec(t);if(e){const n=e[1],r=parseInt(n,16);switch(n.length){case 3:return(ws(r)|4278190080)>>>0;case 4:return rn(Rs(r),8);case 6:return(r|4278190080)>>>0;case 8:return rn(r,8)}}return Kt(`invalid hex color: \"${t}\"`)},$=(t,e=1)=>t!=null?m(t):e,ks=t=>{if(typeof t[0]==\"number\")switch(t.length){case 1:return t.push(0,0,1),[t];case 2:return t.push(0,1),[t];case 3:return t.push(1),[t];default:return[t]}return t},vt=t=>{const e=t.channels||{},n=t.order,r=n.length;n.reduce((f,d)=>(f[d]={range:[0,1],...e[d]},f),e);const s=Object.freeze(n.map(f=>e[f].range[0])),i=Object.freeze(n.map(f=>e[f].range[1])),a=L([],s),o=L([],i);a[r-1]=1;const c=n.findIndex(f=>!!e[f].hue),l=class{constructor(f,d=0,g=1){this.offset=d,this.stride=g,this.buf=f||[0,0,0,0],this.offset=d,this.stride=g}buf;get mode(){return t.mode}get length(){return r}get range(){return[s,i]}get[Symbol.toStringTag](){return t.mode}get xyz(){return[this[0],this[1],this[2]]}[Symbol.iterator](){return bs(this.buf,this.length,this.offset,this.stride)}copy(){return new l(this.deref())}copyView(){return new l(this.buf,this.offset,this.stride)}empty(){return new l}deref(){return[this[0],this[1],this[2],this[3]]}set(f){return L(this,f)}clamp(){return c>=0&&(this[c]=_(this[c])),ls(null,this,s,i),this}eqDelta(f,d=I){return Je(this,f,d)}randomize(f){return ps(this,a,o,f)}toJSON(){return this.deref()}toString(){return os(4,4)(this)}};fs(l.prototype,n),en(t.mode,t.from),en(\"rgb\",{[t.mode]:t.toRgb});const h=(f,d,g)=>{const b=new l(...g);return d!==t.mode?nn(b,f,t.mode,d):b.set(f)},u=(f,...d)=>f==null?new l:P(f)?u(vs(f),...d):Xt(f)?P(f.mode)?h(f,f.mode,d):new l(f,...d):et(f,\"deref\")?h(f.deref(),f.mode,d):q(f)?d.length&&d.every(q)?new l(...ks([f,...d])):h(Ct([],f),\"srgb\",d):Kt(`can't create a ${t.mode} color from: ${f}`);return u.class=l,u.range=[s,i],u.random=(f,d,g,b)=>new l(d,g,b).randomize(f),u.mapBuffer=(f,d=f.length/r|0,g=0,b=1,y=r)=>is(l,f,d,g,b,y),u},Qt=(t,e,n=1)=>(e=_(e)*6,R(t||[],m(Math.abs(e-3)-1),m(2-Math.abs(e-2)),m(2-Math.abs(e-4)),n)),an=(t,e)=>{const n=e[0];let r=e[1];const s=e[2],i=Qt(t||e,n,$(e[3])),a=Vt(i);return s<a?r*=s/a:a<1&&(r*=(1-s)/(1-a)),S(i,m((i[0]-a)*r+s),m((i[1]-a)*r+s),m((i[2]-a)*r+s))},Gs=(t,e,n=1)=>R(t||e,m(e[0]),m(e[1]),m(e[2]),$(e[3],n)),St=(t,e,n=1)=>R(t||e,_(e[0]),m(e[1]),m(e[2]),$(e[3],n)),cn=(t,e)=>{t=St(t||e,e);const n=t[1],r=t[2];if(n<1e-6)return S(t,r,r,r);const s=t[0]*6%6,i=r*(1-n),a=1-Math.abs(s%2-1);let o=3*r*n/(1+a);const c=o*a+i;switch(o+=i,s|0){case 0:return S(t,o,c,i);case 1:return S(t,c,o,i);case 2:return S(t,i,o,c);case 3:return S(t,i,c,o);case 4:return S(t,c,i,o);case 5:return S(t,o,i,c);default:return S(t,i,i,i)}},ln=(t,e)=>{const n=m(e[1]),r=m(e[2]);t=Qt(t||e,e[0],$(e[3]));const s=(1-Math.abs(2*r-1))*n;return S(t,(t[0]-.5)*s+r,(t[1]-.5)*s+r,(t[2]-.5)*s+r)},te=(t,e)=>{t=St(t||e,e);const n=t[1],r=t[2];return Qt(t,e[0],t[3]),S(t,((t[0]-1)*n+1)*r,((t[1]-1)*n+1)*r,((t[2]-1)*n+1)*r)},ee=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,ne=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4),Bt=(t,e)=>R(t||e,ne(e[0]),ne(e[1]),ne(e[2]),$(e[3])),Ms=(t,e)=>Bt(null,Ct(t,e)),Us=(t,e)=>Bt(null,sn(t,e)),re=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],Is=t=>(t%=k,t<0?k+t:t),hn=(t,e)=>Is(Math.atan2(t,e)),se=(t,e)=>{let{1:n,2:r}=e;r*=k;const s=$(e[3]);return n>0?R(t||e,e[0],Math.cos(r)*n,Math.sin(r)*n,s):R(t||e,e[0],0,0,s)},oe=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},fn=(t,e,n=Zr)=>{const r=(e[0]+.16)/1.16;return R(t||e,oe(e[1]/5+r)*n[0],oe(r)*n[1],oe(r-e[2]/2)*n[2],$(e[3]))},xs=(t,e)=>fn(t,e,Jr),ie=(t,e,n=0,r=0,s=1,i=1)=>t[n]*e[r]+t[n+s]*e[r+i]+t[n+2*s]*e[r+2*i],kt=(t,e,n,r=!1)=>{const s=ie(e,n,0,0,3),i=ie(e,n,1,0,3),a=ie(e,n,2,0,3),o=$(n[3]);return r?R(t||n,m(s),m(i),m(a),o):R(t||n,s,i,a,o)},ae=(t,e,n=Xr)=>kt(t,n,e),ce=(t,e)=>ae(t,e,Kr),rt=(t,e)=>ae(null,fn(t,e)),un=(t,e)=>ce(null,xs(t,e)),zs=[4.0767416621,-1.2684380046,-.0041960863,-3.307711591,2.6097574011,-.7034186147,.2309699292,-.3413193965,1.707614701],dn=(t,{0:e,1:n,2:r,3:s})=>kt(t,zs,[(e+.3963377774*n+.2158037573*r)**3,(e-.1055613458*n-.0638541728*r)**3,(e-.0894841775*n-1.291485548*r)**3,s]),gn=(t,e)=>e!==0?t/e:0,mn=vt({mode:\"rgb\",order:[\"r\",\"g\",\"b\",\"alpha\"],from:{abgr32:(t,e)=>Us(t,e[0]),argb32:(t,e)=>Ms(t,e[0]),hcy:an,hsi:cn,hsl:ln,hsv:te,lab50:rt,lab65:un,lch:[se,rt],oklab:dn,rgb:L,srgb:Bt,xyy:[(t,e)=>{const{0:n,1:r,2:s}=e;return R(t||e,gn(s*n,r),s,gn(s*(1-n-r),r),$(e[3]))},ce],xyz50:ae,xyz65:ce,ycc:(t,e,n=Ke)=>{const r=e[0],s=(2-2*n[2])*e[1],i=(2-2*n[0])*e[2];return R(t||e,r+i,r-n[2]/n[1]*s-n[0]/n[1]*i,r+s,$(e[3]))}},toRgb:L}),Os=(t,e)=>{const n=Vt(mn(t))+.05,r=Vt(mn(e))+.05;return n>r?n/r:r/n},bn=t=>{const e=$t(_(t[0])*360),n=Ze(m(t[1])),r=Ze(m(t[2])),s=$(t[3]);return s<1?`hsla(${e},${n},${r},${$t(s)})`:`hsl(${e},${n},${r})`},Es=(t,e)=>{t=St(t||e,e);const n=t[1],r=t[2],s=(2-n)*r/2;return t[2]=s,t[1]=s&&s<1?n*r/(s<.5?s*2:2-s*2):n,t},Fs=t=>bn(Es([],t)),yn=\"0123456789abcdef\",le=t=>yn[t>>>4&15]+yn[t&15],Ds=t=>le(t>>>8)+le(t&255),Ns=t=>le(t>>>16)+Ds(t),he=Ve((t,e,n=\"\")=>{const r=Hr(\"0\",e);return s=>(s=(s>>>0).toString(t),n+(s.length<e?r.substring(s.length)+s:s))});he(2,8),he(2,16),he(2,32);const An=Ns,fe=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${$t(e*M)})`:`#${An(t&16777215)}`},Ts=t=>(t&255)<<16|t>>16&255|t&4278255360,W=(t,e)=>R(t||e,ee(e[0]),ee(e[1]),ee(e[2]),$(e[3])),ue=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,Y=t=>{const e=ue(t[0]),n=ue(t[1]),r=ue(t[2]),s=$(t[3]);return s<1?`rgba(${e},${n},${r},${$t(s)})`:`#${An(e<<16|n<<8|r)}`},_n={abgr32:t=>fe(Ts(t[0])),argb32:t=>fe(t[0]),hsl:bn,hsv:Fs,lab50:t=>Y(W(null,rt([],t))),lab65:t=>Y(W(null,un([],t))),lch:t=>Y(W(null,rt(null,se([],t)))),rgb:t=>Y(W([],t)),srgb:Y};({..._n});let qs=_n;const pn=(t,e=qs)=>{let n;return P(t)?t:q(t)?fe(t):t.mode?(n=e[t.mode])?n(t):e.rgb(nn([],t,\"rgb\",t.mode)):Y(t)},Ps=(t,e)=>{t=St(t||e,e);const n=t[1],r=t[2],s=2*r,i=(s+n*(1-Math.abs(s-1)))*.5;return t[1]=2*(i-r)/i,t[2]=i,t},js=(t,e)=>{t=Gs(t||e,e);const n=t[1]<t[2]?[t[2],t[1],-1,2/3]:[t[1],t[2],0,-1/3],r=t[0]<n[0]?[n[0],n[1],n[3],t[0]]:[t[0],n[1],n[2],n[0]],s=r[0]-Math.min(r[1],r[3]);return S(t,m(Math.abs((r[3]-r[1])/(6*s+I)+r[2])),m(s),m(r[0]))},de=(t,e)=>(t=js(t,e),t[1]/=t[2]+I,t),Ls=vt({mode:\"hsv\",channels:{h:{hue:!0}},order:[\"h\",\"s\",\"v\",\"alpha\"],from:{rgb:de,srgb:de,hsl:Ps,lch:[se,rt,W,de]},toRgb:te}),Gt=(t,e=1)=>{const n=(a,o,c)=>{!a&&(a=o);for(let l=o.length;l-- >0;)a[l]=t(o[l],c);return a},r=(a,o,c)=>(!a&&(a=o),a[0]=t(o[0],c),a[1]=t(o[1],c),a),s=(a,o,c)=>(!a&&(a=o),a[0]=t(o[0],c),a[1]=t(o[1],c),a[2]=t(o[2],c),a),i=(a,o,c)=>(!a&&(a=o),a[0]=t(o[0],c),a[1]=t(o[1],c),a[2]=t(o[2],c),a[3]=t(o[3],c),a);return[G(e,n,r,s,i),r,s,i]},[vi,Si,Hs]=Gt(Math.pow),Ws=Hs,Ys=[.4122214708,.2119034982,.0883024619,.5363325363,.6806995451,.2817188376,.0514459929,.1073969566,.6299787005],Vs=(t,e)=>kt(null,Qr,Ws(null,kt(t,Ys,e),1/3)),wn=(t,e)=>R(t||e,e[0],Math.hypot(e[1],e[2]),hn(e[2],e[1])*Gr,$(e[3])),Xs=vt({mode:\"oklch\",channels:{c:{range:[0,.3225]}},order:[\"l\",\"c\",\"h\",\"alpha\"],from:{oklab:wn,rgb:(t,e)=>wn(null,Vs(t,e))},toRgb:[(t,e)=>R(t||e,e[0],...re(e[2]*k,e[1]),$(e[3])),dn]}),Rn=vt({mode:\"srgb\",order:[\"r\",\"g\",\"b\",\"alpha\"],from:{abgr32:(t,e)=>sn(t,e[0]),argb32:(t,e)=>Ct(t,e[0]),hcy:an,hsi:cn,hsl:ln,hsv:te,rgb:W},toRgb:Bt}),Ks=(t,e)=>t===e?0:t==null?e==null?0:-1:e==null?t==null?0:1:typeof t.compare==\"function\"?t.compare(e):typeof e.compare==\"function\"?-e.compare(t):t<e?-1:t>e?1:0,Zs=t=>typeof t==\"function\"?t:e=>e[t];function $n(t,e=Ks){const n=Zs(t);return(r,s)=>e(n(r),n(s))}const Js=(t,e)=>e-t,ge=(t,e=1,n=!0)=>{const r=n?(o,c,l)=>{!o&&(o=c);for(let h=c.length;h-- >0;)o[h]=t(c[h],l[h]);return o}:(o,c,l)=>{!o&&(o=l);for(let h=c.length;h-- >0;)o[h]=t(c[h],l[h]);return o},s=n?(o,c,l)=>(!o&&(o=c),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o):(o,c,l)=>(!o&&(o=l),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o),i=n?(o,c,l)=>(!o&&(o=c),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o[2]=t(c[2],l[2]),o):(o,c,l)=>(!o&&(o=l),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o[2]=t(c[2],l[2]),o),a=n?(o,c,l)=>(!o&&(o=c),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o[2]=t(c[2],l[2]),o[3]=t(c[3],l[3]),o):(o,c,l)=>(!o&&(o=l),o[0]=t(c[0],l[0]),o[1]=t(c[1],l[1]),o[2]=t(c[2],l[2]),o[3]=t(c[3],l[3]),o);return[G(e,r,s,i,a),s,i,a]},Qs=(t,e)=>t+e,to=(t,e)=>t*e,eo=(t,e)=>t-e,[no,ro]=ge(Qs),Cn=no,so=ro,oo=Object.freeze([0,0]),io=Object.freeze([0,0,0]),vn=Math.cos,Sn=Math.sin,Bn=G(1);Bn.add(2,(t,e,n=oo)=>so(t||e,re(e[1],e[0]),n)),Bn.add(3,(t,e,n=io)=>{const r=e[0],s=e[1],i=e[2],a=vn(s);return S(t||e,r*a*vn(i)+n[0],r*a*Sn(i)+n[1],r*Sn(s)+n[2])});const ao=(t,e)=>{const n=[];for(let r of t)n.push(re(r,e));return n},co=t=>A(t.length>0,\"no inputs given\"),[lo]=Gt(to),kn=lo,ho=G(0,t=>{let e=0;for(let n=t.length;n-- >0;)e+=t[n];return e},t=>t[0]+t[1],t=>t[0]+t[1]+t[2],t=>t[0]+t[1]+t[2]+t[3]),fo=(t,e)=>{co(e),t=rs(t||[],e[0]);for(let n=e.length;n-- >1;)Cn(t,t,e[n]);return kn(t,t,1/e.length)},me=t=>t.length>0?ho(t)/t.length:0,[uo]=Gt(eo),go=uo,Gn=(t,e)=>go(t,e,me(e)),mo=t=>hn(t[1],t[0]),bo=G(0,t=>{let e=0;for(let n=t.length;n-- >0;)e+=t[n]*t[n];return e},t=>t[0]*t[0]+t[1]*t[1],t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t=>t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]),yo=(t,e=!1,n=!1)=>{const r=~~n;return t.length>r?bo(e?t:Gn([],t))/(t.length-r):0},be=(t,e=!1,n=!1)=>Math.sqrt(yo(t,e,n)),ye=t=>mo(fo([],ao(t))),Ao=(t,e)=>{const n=ye(e);!t&&(t=[]);for(let r=0,s=e.length;r<s;r++)t[r]=(e[r]-n+Ne)%k;return Gn(null,t)},_o=(t,e)=>be(Ao([],t),!0,e);ge(Math.max);const po=t=>{let e=-1/0;for(let n=t.length;n-- >0;)e=Math.max(e,t[n]);return e},Ae=t=>{if(!t.length)return 0;const e=t.length,n=e>>1;return t=[...t].sort((r,s)=>r-s),e&1?t[n]:(t[n-1]+t[n])*.5};ge(Math.min);const wo=t=>{let e=1/0;for(let n=t.length;n-- >0;)e=Math.min(e,t[n]);return e},Ro=t=>{const[e,n]=pe(t);return{min:e,max:n,mean:me(t),median:Ae(t),sd:be(t)}},_e=(t,e)=>{const[n,r]=pe(t);return{min:n,max:r,mean:me(t),median:Ae(t),sd:be(t),weighted:Lr(t,e)}},$o=t=>{const e=t.map(i=>i*k),n=_(ye(e)/k),[r,s]=Co(t,n);return{min:r,max:s,mean:n,median:vo(t,r,s),sd:_o(e)/k}},pe=t=>[wo(t),po(t)],Co=(t,e)=>{const n=pe(t),[r,s]=n;return e<r||e>s?[t.reduce((i,a)=>{const o=_(e-a);return o<.5&&o>i[1]?[a,o]:i},[s,_(e-s)])[0],t.reduce((i,a)=>{const o=_(a-e);return o<.5&&o>i[1]?[a,o]:i},[r,_(r-e)])[0]]:n},vo=(t,e,n)=>{if(e<=n)return Ae(t);const r=t.length,s=r>>1,i=[...t].sort((c,l)=>c-l),a=i.findIndex(c=>c===e),o=i.slice(a).concat(i.slice(0,a));return r&1?o[s]:(o[s-1]+o[s])*.5},So=t=>typeof t==\"function\",Bo=G(0,(t,e)=>{let n=0;for(let r=t.length;r-- >0;){const s=t[r]-e[r];n+=s*s}return n},(t,e)=>{const n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},(t,e)=>{const n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return n*n+r*r+s*s},(t,e)=>{const n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return n*n+r*r+s*s+i*i});class ko{constructor(e){this.metric=e}to(e){return e*e}from(e){return Math.sqrt(e)}}const we=new ko(Bo),Mn=(t,e,n=we)=>{const r=So(n)?n:n.metric;let s=1/0,i=-1;for(let a=0,o=e.length;a<o;a++){const c=r(t,e[a]);c<s&&(s=c,i=a)}return i};G(0,(t,e)=>{for(let n=t.length;n-- >0;)t[n]=e;return t},(t,e)=>(t[0]=e,t[1]=e,t),(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t),(t,e)=>(t[0]=e,t[1]=e,t[2]=e,t[3]=e,t));const Go=t=>Array(t).fill(0),Mo=t=>Array(t).fill(1),Uo=(t,e,n={})=>{let{dim:r=e[0].length,dist:s=we,maxIter:i=32,strategy:a=Oo,exponent:o,initial:c,rnd:l}=n;const h=e.length,u=Array.isArray(c)?c:c?c(t,e,s,l):Io(t,e,s,l,o);A(u.length>0,\"missing initial centroids\"),t=u.length;const f=new Uint32Array(h).fill(t);let d=!0;for(;d&&i-- >0&&(d=xo(e,u,f,s),!!d);)for(let g=0;g<t;g++){const b=a(r);for(let p=0;p<h;p++)g===f[p]&&b.update(e[p]);const y=b.finish();y&&(u[g]=y)}return zo(u,f)},Io=(t,e,n=we,r=Zt,s=2)=>{const i=e.length;A(i>0,\"missing samples\"),t=Math.min(t,i);const a=[r.int()%i],o=[e[a[0]]],c=new Array(i).fill(0).map((h,u)=>u),l=n.metric;for(;a.length<t;){let h=0;const u=e.map(d=>{const g=n.from(l(d,o[Mn(d,o,n)]))**s;return h+=g,g});if(!h)break;let f;do f=_s(c,u,r)();while(a.includes(f));a.push(f),o.push(e[f])}return o},xo=(t,e,n,r)=>{let s=!1;for(let i=t.length;i-- >0;){const a=Mn(t[i],e,r);a!==n[i]&&(n[i]=a,s=!0)}return s},zo=(t,e)=>{const n=[];for(let r=0,s=e.length;r<s;r++){const i=e[r];(n[i]||(n[i]={id:i,centroid:t[i],items:[]})).items.push(r)}return n.filter(r=>!!r)},Oo=t=>{const e=Go(t);let n=0;return{update:r=>{Cn(e,e,r),n++},finish:()=>n?kn(e,e,1/n):void 0}},Eo=(t,e)=>{const n=[];let r=0;for(let s of e)t(s,r)&&n.push(s),r++;return n},Un=(t,e,n)=>{const r=n?.filter?Eo(n.filter,t):Array.isArray(t)?t:[...t];return r.length?Uo(Math.min(e,r.length),r,n).sort((s,i)=>i.items.length-s.items.length).map(s=>({color:[...s.centroid],area:s.items.length/r.length,ids:s.items})):[]},Re=t=>typeof t?.[Symbol.iterator]==\"function\",In=(t,e)=>[t[0],t[1],e],$e=Symbol(),xn=()=>{},Mt=t=>et(t,\"xform\")?t.xform():t,Fo=ht(()=>\"illegal arity\"),Ce=t=>{throw new Fo(t)};class Ut{value;constructor(e){this.value=e}deref(){return this.value}}const V=t=>t instanceof Ut,Do=t=>t instanceof Ut?t:new Ut(t),st=t=>t instanceof Ut?t.deref():t,No=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Ce(t.length);function It(...t){const e=t[0],n=e[0],r=e[1],s=e[2];t=No(t);const i=t[0]==null?n():t[0],a=t[1];return st(r(et(a,\"$reduce\")?a.$reduce(s,i):Xt(a)?To(s,i,a):qo(s,i,a)))}const To=(t,e,n)=>{for(let r=0,s=n.length;r<s;r++)if(e=t(e,n[r]),V(e)){e=e.deref();break}return e},qo=(t,e,n)=>{for(let r of n)if(e=t(e,r),V(e)){e=e.deref();break}return e},ve=(t,e)=>[t,ft,e],xt=(t,e)=>{const n=e.length-1;return Re(e[n])?e.length>1?It(t.apply(null,e.slice(0,n)),e[n]):It(t(),e[0]):void 0};function zn(t){return t?[...t]:ve(()=>[],(e,n)=>(e.push(n),e))}function*Po(t,e){const n=Mt(t)(zn()),r=n[1],s=n[2];for(let i of e){const a=s([],i);if(V(a)){yield*st(r(a.deref()));return}a.length&&(yield*a)}yield*st(r([]))}function*jo(t,e){const n=Mt(t)([xn,xn,(r,s)=>s])[2];for(let r of e){let s=n($e,r);if(V(s)){s=st(s.deref()),s!==$e&&(yield s);return}s!==$e&&(yield s)}}function ot(t,e){return Re(e)?jo(ot(t),e):n=>{const r=n[2];return In(n,(s,i)=>r(s,t(i)))}}function On(t){return t?It(On(),t):ve(()=>-1/0,(e,n)=>Math.max(e,n))}const En=t=>((t==null||!t[Symbol.iterator])&&Kt(`value is not iterable: ${t}`),t),Lo=t=>tn(t)?t:[...En(t)],Ho=t=>Xt(t)?t:[...En(t)];function*Wo(...t){const e=t.length-1;if(e<0)return;const n=new Array(e+1).fill(0),r=t.map(Ho),s=r.reduce((i,a)=>i*a.length,1);for(let i=0;i<s;i++){const a=[];for(let o=e;o>=0;o--){const c=r[o];let l=n[o];l===c.length&&(n[o]=l=0,o>0&&n[o-1]++),a[o]=c[l]}n[e]++,yield a}}function Se(...t){return Yo(Se,It,t)}const Yo=(t,e,n)=>{let r,s;switch(n.length){case 4:s=n[3],r=n[2];break;case 3:s=n[2];break;case 2:return ot(i=>t(n[0],n[1],i));default:Ce(n.length)}return e(Mt(n[0])(n[1]),r,s)},[Vo]=Gt(Pe),Xo=Vo,Fn=(t,e,n)=>Ko(m((n-t)/(e-t))),Ko=t=>t*t*(3-2*t);function Dn(...t){let[e,n,r,s,i,a,o,c,l,h]=t;switch(t.length){case 0:Ce(0);case 1:return e;case 2:return(...f)=>e(n(...f));case 3:return(...f)=>e(n(r(...f)));case 4:return(...f)=>e(n(r(s(...f))));case 5:return(...f)=>e(n(r(s(i(...f)))));case 6:return(...f)=>e(n(r(s(i(a(...f))))));case 7:return(...f)=>e(n(r(s(i(a(o(...f)))))));case 8:return(...f)=>e(n(r(s(i(a(o(c(...f))))))));case 9:return(...f)=>e(n(r(s(i(a(o(c(l(...f)))))))));case 10:default:const u=(...f)=>e(n(r(s(i(a(o(c(l(h(...f))))))))));return t.length===10?u:Dn(u,...t.slice(10))}}function Zo(...t){return t=t.map(Mt),Dn.apply(null,t)}function Nn(...t){const e=xt(Nn,t);if(e!==void 0)return e;const[n=0,r=1]=t;return ve(()=>n,(s,i)=>s+r)}const Jo=t=>t,Qo=t=>({key:e=>e,group:zn(),...t});function Tn(...t){const e=xt(Tn,t);if(e!==void 0)return e;const n=Qo(t[0]),[r,s,i]=n.group;return[()=>new Map,a=>{for(let o of a.keys())a.set(o,s(a.get(o)));return a},(a,o)=>{const c=n.key(o);return a.set(c,a.has(c)?i(a.get(c),o):i(r(),o))}]}function qn(...t){return xt(qn,t)||Tn({key:t[0]||Jo,group:Nn()})}function Pn(...t){const e=xt(Pn,t);if(e!==void 0)return e;const[n,r,s]=qn(...t);let i=0;return[n,a=>{a=r(a);for(let o of a)a.set(o[0],o[1]/i);return a},(a,o)=>(i++,s(a,o))]}const ti=()=>t=>{const e=t[2];return In(t,(n,r)=>{if(r){for(let s of st(r)||[])if(n=e(n,s),V(n))break}return V(r)?Do(n):n})};function jn(t,e){return Re(e)?Po(jn(t),e):Zo(ot(t),ti())}function*ei(t,e=1/0){for(;e-- >0;)yield t}const Ln=(t,e=.2,n)=>{const r=Lo(t),s=r.filter(u=>u[1]>=e),i=s.length/r.length,a=[...Se(ot(u=>Pe(u[0],1/12)%1),Pn(),s)].sort($n(0)),o=[...jn(([u,f])=>(f*=50,f>=1?ei(u*k,f):null),a)];if(!o.length)return{hues:a,meanHue:0,temp:0,areaTemp:0,area:0};const c=ye(o)/k,l=ri(c,n),h=l*i;return{hues:a,meanHue:c,temp:l,areaTemp:h,area:i}},ni=[.1,.6,.72,.92],ri=(t,[e,n,r,s]=ni)=>2*(t<2/3?Fn(n,e,t):Fn(r,s,t))-1,si=(t,e)=>{let n=t.format!==j?t.as(j):t;e?.size&&(n=ai(n,e.size));const r=n.as(Ee),s=n.as(qr),i=ii(n,e),a=i.map(l=>l.area),o=oi(i.map(l=>l.color),a,e?.minSat,e?.tempCoeffs),c=Ro(r.data);return{...o,img:n,imgGray:r,imgHsv:s,lumImg:c,temperature:Ln(s,e?.minSat,e?.tempCoeffs),contrastImg:c.max-c.min}},oi=(t,e=Mo(t.length),n,r)=>{const s=t.map(f=>ts(f)),i=t.map(f=>Rn(f)),a=i.map(f=>Ls(f)),o=i.map(f=>Xs(f)),c=i.map(f=>pn(f)),l=a.map(f=>f[0]),h=a.map(f=>f[1]),u=_e(s,e);return{css:c,srgb:i,hsv:a,oklch:o,hue:$o(l),sat:_e(h,e),chroma:_e(o.map(f=>f[1]),e),lum:u,areas:e,contrast:u.max-u.min,colorContrast:Nr(Se(ot(f=>Os(...f)),On(),Wo(i,i)),1,21,0,1),temperature:Ln(a,n,r)}},ii=(t,{dominantFn:e=Un,numColors:n=4,prec:r=.001}={})=>e(t,n).sort($n(\"area\",Js)).map(s=>(Xo(null,s.color,r),s)),ai=(t,e)=>{e=~~e;let n=t.width,r=t.height;return[n,r]=n>r?[e,~~Math.max(1,r/n*e)]:[~~Math.max(1,n/r*e),e],t.resize(n,r)};self.onmessage=async t=>{const{imageBitmap:e,settings:n}=t.data;try{const r=await ci(e,n);self.postMessage({success:!0,data:r})}catch(r){self.postMessage({success:!1,error:r.message,stack:r.stack})}};async function ci(t,e){const r={...{numColors:3,lightnessThreshold:.5,yFrom:0,yTo:1,maxSize:320,alphaThreshold:30},...e},{numColors:s,lightnessThreshold:i,yFrom:a,yTo:o,maxSize:c,alphaThreshold:l}=r,h=t.width,u=t.height;if(!h||!u)return!1;let f=1;(h>c||u>c)&&(f=Math.min(c/h,c/u));const d=Math.floor(h*f),g=Math.floor(u*f),b=0,y=Math.floor(a*u),p=Math.max(1,h),N=Math.max(1,Math.ceil((o-a)*u)),U=Math.max(1,d),it=Math.max(1,Math.ceil((o-a)*g)),Hn=new OffscreenCanvas(U,it);Hn.getContext(\"2d\").drawImage(t,b,y,p,N,0,0,U,it);const hi=Fr(Hn,j),fi=si(hi,{numColors:s,dominantFn:(X,K)=>Un(X,K,{filter:Z=>{const{alpha:at}=Rn(Z);return at>0}}),prec:.01}),{lumImg:ui,srgb:di,areas:gi}=fi,Wn=new OffscreenCanvas(d,g).getContext(\"2d\");Wn.drawImage(t,0,0,h,u,0,0,d,g);const mi=Wn.getImageData(0,0,d,g).data,Yn=li(mi,d,g,l);function bi(X,K,Z,at){return(.299*X+.587*K+.114*Z)/255<at}return{isDark:ui.mean<i,isTransparent:Yn?.any,transparencyInfo:Yn,dominantColors:di.map(({r:X,g:K,b:Z},at)=>({color:pn([X,K,Z]),area:gi?.[at],isDark:bi(X*255,K*255,Z*255,i)}))}}function li(t,e,n,r){const s={any:!0,left:!0,right:!0,top:!0,bottom:!0};let i={any:0,left:0,right:0,top:0,bottom:0};const a=Math.floor(.15*e),o=Math.floor((n>100?.05:.5)*n),c=Math.floor(e*n*.001);if(e>0&&n>0){for(let l=0;l<e;l++){const h=(0*e+l)*4+3;if(t[h]>r&&(i.top++,i.top>=a)){s.top=!1;break}}for(let l=0;l<e;l++){const h=((n-1)*e+l)*4+3;if(t[h]>r&&(i.bottom++,i.bottom>=a)){s.bottom=!1;break}}for(let l=0;l<n;l++){const h=(l*e+0)*4+3;if(t[h]>r&&(i.left++,i.left>=o)){s.left=!1;break}}for(let l=0;l<n;l++){const h=(l*e+(e-1))*4+3;if(t[h]>r&&(i.right++,i.right>=o)){s.right=!1;break}}if(!s.top&&!s.bottom&&!s.left&&!s.right){for(let l=3;l<t.length;l+=4)if(t[l]>r&&(i.any++,i.any>=c)){s.any=!1;break}}else s.any=!0}return s}})();\n";
